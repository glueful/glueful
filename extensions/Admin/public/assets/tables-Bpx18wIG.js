import{_ as Ne}from"./Slideover-Bz-TrAjm.js";import{_ as Pe}from"./Tabs-Rxng3JkH.js";import{c as je,f as _e,u as Fe,_ as Re,n as pe,a as qe,b as ge,d as De,g as Ke,r as He,e as Oe}from"./ConfirmModal.vue_vue_type_script_setup_true_lang-MhcffMh4.js";import{_ as Ye}from"./Checkbox-D3Mbv2b_.js";import{_ as Ge}from"./Select-C57MTzpF.js";import{d as O,f as U,i as j,o as c,j as d,m as fe,p as ve,l as M,P as Qe,G as Xe,H as Ze,r as w,E as K,B as y,F as P,k as a,Z as l,ah as Ce,Q as Te,N as X,ai as Z,O as T,al as be,K as Je,R as We,a3 as et,a6 as ye,a7 as tt,z as le,X as H,ak as at,as as lt,A as $e,af as st,aG as ot,a1 as nt,aq as rt,Y as xe,an as it}from"./index-CRsdYi2H.js";import{_ as ut}from"./FormField-B_wRBRDF.js";import{_ as Ve}from"./Input-BHZUZoYe.js";import{u as Ue}from"./dbTables-D08AeIB0.js";import{_ as dt,b as we}from"./route-block-BD734aAn.js";import{_ as ct}from"./Popover-C0cVA3Nr.js";import{_ as Se}from"./Badge-AijS7S0U.js";import{_ as Ie}from"./Skeleton-D_IVtAoi.js";import{_ as mt}from"./DashboardNavbar.vue_vue_type_script_setup_true_lang-BjOyJKj1.js";import{u as pt}from"./useToastNotification-BcotWXPZ.js";import"./DialogPortal-CiOOOcvu.js";import"./useBodyScrollLock-B9_nYFZW.js";import"./DashboardSidebarToggle.vue_vue_type_script_setup_true_lang-DsgFYwLG.js";import"./TabsTrigger-BPe8l6ke.js";import"./RovingFocusGroup-BBmQv82t.js";import"./useDirection-k4nYEygm.js";import"./RovingFocusItem-h949RZXv.js";import"./index-DB23InID.js";import"./index-BkXOrXe_.js";import"./useFocusGuards-Du7C4AgP.js";import"./useArrowNavigation-B5rxJs06.js";import"./CollapsibleTrigger-DPh81dER.js";import"./Modal-B3tkIP1b.js";import"./isValueEqualOrExist-BBQ1z4Lv.js";import"./useFormControl-NdRzoGR7.js";import"./VisuallyHiddenInput-C3uj9iqK.js";import"./Label-PeVd4_oV.js";import"./DashboardResizeHandle.vue_vue_type_script_setup_true_lang-BBA6ihDY.js";const vt=O({__name:"BaseSeparator",props:{orientation:{default:"horizontal"},decorative:{type:Boolean},asChild:{type:Boolean},as:{}},setup(f){const o=f,x=["horizontal","vertical"];function _(r){return x.includes(r)}const v=U(()=>_(o.orientation)?o.orientation:"horizontal"),$=U(()=>v.value==="vertical"?o.orientation:void 0),b=U(()=>o.decorative?{role:"none"}:{"aria-orientation":$.value,role:"separator"});return(r,m)=>(c(),j(M(Qe),ve({as:r.as,"as-child":r.asChild,"data-orientation":v.value},b.value),{default:d(()=>[fe(r.$slots,"default")]),_:3},16,["as","as-child","data-orientation"]))}}),ft=O({__name:"Separator",props:{orientation:{default:"horizontal"},decorative:{type:Boolean},asChild:{type:Boolean},as:{}},setup(f){const o=f;return(x,_)=>(c(),j(vt,Xe(Ze(o)),{default:d(()=>[fe(x.$slots,"default")]),_:3},16))}}),bt={class:"space-y-4"},ht={class:"mt-6"},_t={class:"pt-4"},gt={class:"flex items-center justify-between mb-3"},yt={key:0,class:"text-sm text-gray-500 text-center py-4 border rounded-md"},xt={class:"flex items-center w-full"},wt={class:"flex items-center justify-center px-2 cursor-move drag-handle"},Ct={class:"flex flex-1 items-center justify-between"},Tt={class:"font-medium truncate max-w-[180px]"},$t={class:"text-xs text-gray-500 mr-2"},Vt={class:"p-3 pt-0"},Ut={class:"flex-1"},St={class:"grid grid-cols-2 gap-4 mb-4"},It={class:"flex flex-wrap gap-4"},zt={class:"pt-4"},kt={class:"flex items-center justify-between mb-3"},Et={key:0,class:"text-sm text-gray-500 text-center py-4 border rounded-md"},Mt={key:1,class:"space-y-3"},Lt={class:"flex items-center w-full"},Bt={class:"flex flex-1 items-center justify-between"},At={class:"text-xs text-gray-500 mr-2"},Nt={class:"p-3 pt-0"},Pt={class:"space-y-3"},jt={class:"grid grid-cols-2 gap-4"},Ft={class:"pt-4"},Rt={class:"flex items-center justify-between mb-3"},qt={key:0,class:"text-sm text-gray-500 text-center py-4 border rounded-md"},Dt={key:1,class:"space-y-3"},Kt={class:"flex items-center w-full"},Ht={class:"flex flex-1 items-center justify-between"},Ot={class:"text-xs text-gray-500 mr-2"},Yt={class:"p-3 pt-0"},Gt={class:"space-y-3"},Qt={class:"flex justify-end gap-2"},Xt=O({__name:"TableSlideover",props:{open:{type:Boolean,default:!1},submitting:{type:Boolean,default:!1},slideoverTitle:{type:String,default:"Create New Table"}},emits:["update:open","close","submit","update:submitting"],setup(f,{emit:o}){const x=f,_=w(!1),v=w(!1),$=w(0),b=U(()=>`${x.slideoverTitle} | ${je.value.toUpperCase()}`),r=o,m=Ue(),S=U({get:()=>x.open,set:t=>r("update:open",t)}),p=U({get:()=>x.submitting,set:t=>r("update:submitting",t)}),I=w(""),E=w(void 0),n=w([]),z=w([]),L=w([]),A=w({}),Y=w({}),R=w({}),F=U(()=>I.value.trim()!==""&&!E.value&&n.value.length>0&&n.value.every(t=>t.name.trim()!==""&&!t.nameError)),se=U(()=>n.value.some(t=>{var e;return(e=t.options)==null?void 0:e.primary})),G=U(()=>n.value.length>0&&n.value.some(t=>t.name.trim()!==""));function J(t,e){if(!t.trim())return`${e==="table"?"Table":"Column"} name is required`;if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t))return`${e==="table"?"Table":"Column"} must start with letter or underscore and contain only letters, numbers, and underscores`;if(He.includes(t.toLowerCase()))return`${e==="table"?"Table":"Column"} name cannot be a reserved SQL keyword`;if(e==="table"&&m.tables.some(C=>typeof C=="string"?C.toLowerCase()===t.toLowerCase():C&&typeof C=="object"&&C.name?C.name.toLowerCase()===t.toLowerCase():!1))return`Table '${t}' already exists in the database`}function h(t){return J(t,"column")}function g(t){return J(t,"table")}function q(){n.value.length===0&&[{name:"id",type:"BIGINT",options:{length:"20",nullable:!1,primary:!0,autoIncrement:!0},nameError:void 0},{name:"uuid",type:"CHAR",options:{length:"12",nullable:!1,primary:!1},nameError:void 0},{name:"created_at",type:"TIMESTAMP",options:{length:null,nullable:!1,primary:!1,default:"CURRENT_TIMESTAMP"},nameError:void 0},{name:"updated_at",type:"TIMESTAMP",options:{length:null,nullable:!0,primary:!1},nameError:void 0}].forEach(e=>{const i=n.value.length;n.value.push(e),A.value[i]=!1})}function W(){const t=n.value.length,e=n.value.length===0;n.value.push({name:"",type:"INT",options:{length:"11",nullable:!e,primary:e,autoIncrement:e},nameError:void 0}),A.value[t]=!0}function oe(t){n.value.splice(t,1);const e={};for(let i=0;i<n.value.length;i++)e[i]=A.value[i<t?i:i+1]||!1;A.value=e}function ne(){z.value.push({type:"INDEX",column:n.value.length>0?n.value[0].name:""})}function re(t){z.value.splice(t,1)}function ie(){L.value.push({column:n.value.length>0?n.value[0].name:"",references:"id",on:""})}function ue(t){L.value.splice(t,1)}function ee(){v.value?_.value=!0:te()}function te(){S.value=!1,_.value=!1,r("close"),setTimeout(()=>{I.value="",E.value=void 0,n.value=[],z.value=[],L.value=[],A.value={},Y.value={},R.value={},v.value=!1},100)}function Q(){if(!F.value||(E.value=g(I.value),n.value.forEach(e=>{e.nameError=h(e.name)}),E.value||n.value.some(e=>e.nameError)))return;p.value=!0;const t={table_name:I.value.trim(),columns:n.value.map(e=>{let i=e.type;pe(e.type)&&e.options.length&&(i=`${e.type}(${e.options.length})`);const V=e.options.autoIncrement&&ge(e.type)?Ke():void 0;return{name:e.name.trim(),type:i,options:{nullable:e.options.nullable?"NULL":"NOT NULL",primary:e.options.primary?"PRIMARY KEY":void 0,autoIncrement:V,default:e.options.default||void 0}}})};if(z.value.length>0){const e=z.value.filter(i=>i.column);e.length>0&&(t.indexes=e.map(i=>({type:i.type,column:i.column})))}if(L.value.length>0){const e=L.value.filter(i=>i.column&&i.references&&i.on);e.length>0&&(t.foreign_keys=e.map(i=>({column:i.column,references:i.references,on:i.on})))}r("submit",t),p.value=!1,ee()}K(n,t=>{t.forEach(e=>{if(e.name){const i=_e(e.name);i!==e.name&&(e.name=i)}e.nameError=h(e.name)})},{deep:!0}),K(I,t=>{if(t){const e=_e(t);e!==t&&(I.value=e)}E.value=g(t)}),K(S,t=>{t&&(q(),v.value=!1,$.value=n.value.length)}),K([n,z,L,I],()=>{const t=n.value.length>$.value,e=z.value.length>0,i=L.value.length>0,V=I.value.trim()!=="";v.value=t||e||i||V},{deep:!0}),K(p,t=>{r("update:submitting",t)});const ae=w(null);K(ae,t=>{t&&Fe(t,n,{animation:150,handle:".drag-handle",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",onEnd:()=>{const e={};n.value.forEach((i,V)=>{e[V]=A.value[V]||!1}),A.value=e}})});const de=w([{label:"Columns",icon:"i-lucide-columns",slot:"columns-tab"},{label:"Indexes",icon:"i-lucide-hash",slot:"indexes-tab"},{label:"Foreign Keys",icon:"i-lucide-network",slot:"foreign-keys-tab"}]),k=U(()=>!m.tables||!Array.isArray(m.tables)||m.tables.length===0?[]:m.tables.map(t=>{const e=typeof t=="string"||t&&typeof t=="object"&&t?t:"";return{label:e,value:e}}).filter(t=>t.value!=="")),ze=U(()=>G.value&&k.value.length>0),N=w({});async function ke(t){if(!(!t||t.trim()==="")){console.debug("Fetching columns for table:",t),N.value[t]?(N.value[t].isLoading=!0,N.value[t].error=void 0):N.value[t]={columns:[],isLoading:!0,error:void 0};try{const e=await m.fetchTableColumns(t);console.debug("API Response for columns:",e);const i=e?e.columns||e:[];if(console.log("Column data:",i),Array.isArray(i))N.value[t]={columns:i.map(V=>{const C=V.name||V;return{label:typeof C=="string"?`${C}`:C,value:typeof C=="string"?C:String(C)}}),isLoading:!1,error:void 0};else throw new Error("Invalid column data format");console.log("Processed columns for UI:",N.value[t].columns)}catch(e){console.error("Error fetching columns:",e),N.value[t]={columns:[],isLoading:!1,error:(e==null?void 0:e.message)||"Failed to load columns"}}}}function Ee(t,e){const i=t?String(t):null;i&&(L.value[e].references="",ke(i))}return(t,e)=>{const i=Ve,V=ut,C=Ce,Me=be,D=Ge,ce=Ye,me=Re,Le=Pe,Be=Ne;return c(),y(P,null,[a(Be,{open:S.value,"onUpdate:open":e[1]||(e[1]=s=>S.value=s),title:b.value,close:!1,side:"right",class:"w-full max-w-lg",ui:{footer:"justify-end"}},{body:d(()=>[l("div",bt,[l("form",{onSubmit:Te(Q,["prevent"])},[a(V,{label:"Table Name",name:"tableName",required:"",error:E.value},{default:d(()=>[a(i,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=s=>I.value=s),placeholder:"Enter table name",disabled:p.value,autofocus:"",class:"w-full",status:E.value?"error":void 0},null,8,["modelValue","disabled","status"])]),_:1},8,["error"]),l("div",ht,[a(Le,{items:de.value,class:"w-full",variant:"link"},{"columns-tab":d(()=>[l("div",_t,[l("div",gt,[e[5]||(e[5]=l("h3",{class:"text-sm font-medium"},"Columns",-1)),a(C,{size:"xs",color:"neutral",variant:"soft",icon:"i-lucide-plus",onClick:W,disabled:p.value},{default:d(()=>e[4]||(e[4]=[X(" Add Column ")])),_:1,__:[4]},8,["disabled"])]),n.value.length===0?(c(),y("div",yt,' No columns added yet. Click "Add Column" to add one. ')):(c(),y("div",{key:1,class:"space-y-3",ref_key:"columnsContainer",ref:ae},[(c(!0),y(P,null,Z(n.value,(s,B)=>(c(),y("div",{key:B,class:"border rounded-md"},[a(me,{open:A.value[B],"onUpdate:open":u=>A.value[B]=u,class:"w-full"},{content:d(()=>[l("div",Vt,[l("div",Ut,[a(V,{label:"Column Name",class:"mb-4",required:!0,error:s.nameError},{default:d(()=>[a(i,{modelValue:s.name,"onUpdate:modelValue":u=>s.name=u,placeholder:"Column name",disabled:p.value,class:"w-full",status:s.nameError?"error":void 0},null,8,["modelValue","onUpdate:modelValue","disabled","status"])]),_:2},1032,["error"]),l("div",St,[a(V,{label:"Type"},{default:d(()=>[a(D,{modelValue:s.type,"onUpdate:modelValue":u=>s.type=u,items:M(qe),disabled:p.value,placeholder:"Select type",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","items","disabled"])]),_:2},1024),a(V,{label:"Length"},{default:d(()=>[a(i,{modelValue:s.options.length,"onUpdate:modelValue":u=>s.options.length=u,placeholder:"255",type:"number",min:"1",disabled:p.value||!M(pe)(s.type),class:"w-full"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)]),l("div",It,[a(ce,{modelValue:s.options.nullable,"onUpdate:modelValue":u=>s.options.nullable=u,label:"Nullable",disabled:p.value},null,8,["modelValue","onUpdate:modelValue","disabled"]),a(ce,{modelValue:s.options.primary,"onUpdate:modelValue":u=>s.options.primary=u,label:"Primary",disabled:p.value||se.value&&!s.options.primary},null,8,["modelValue","onUpdate:modelValue","disabled"]),a(ce,{modelValue:s.options.autoIncrement,"onUpdate:modelValue":u=>s.options.autoIncrement=u,label:"Auto Increment",disabled:p.value||!s.options.primary||!M(ge)(s.type)},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),a(V,{label:"Default Value",class:"mt-4"},{default:d(()=>[a(i,{modelValue:s.options.default,"onUpdate:modelValue":u=>s.options.default=u,placeholder:"Default value",disabled:p.value,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)])]),default:d(()=>[l("div",xt,[l("div",wt,[a(Me,{name:"i-lucide-grip-vertical",class:"text-gray-400 hover:text-gray-600"})]),a(C,{class:"group flex-1 flex items-center justify-between p-3 text-left",color:"neutral",variant:"ghost","trailing-icon":"i-lucide-settings-2",ui:{trailingIcon:"group-data-[state=open]:rotate-90 transition-transform duration-200"}},{default:d(()=>[l("div",Ct,[l("div",Tt,T(s.name||"New Column"),1),l("div",$t,T(s.type)+T(M(pe)(s.type)?`(${s.options.length})`:"")+" "+T(s.options.primary?"• Primary":"")+" "+T(s.options.nullable?"• Nullable":"• NOT NULL"),1)])]),_:2},1024),a(C,{color:"error",variant:"ghost",icon:"i-lucide-trash-2",size:"sm",class:"mr-2",onClick:u=>oe(B),disabled:p.value},null,8,["onClick","disabled"])])]),_:2},1032,["open","onUpdate:open"])]))),128))],512))])]),"indexes-tab":d(()=>[l("div",zt,[l("div",kt,[e[7]||(e[7]=l("h3",{class:"text-sm font-medium"},"Indexes",-1)),a(C,{size:"xs",color:"neutral",variant:"soft",icon:"i-lucide-plus",onClick:ne,disabled:p.value||!G.value},{default:d(()=>e[6]||(e[6]=[X(" Add Index ")])),_:1,__:[6]},8,["disabled"])]),z.value.length===0?(c(),y("div",Et,' No indexes added yet. Click "Add Index" to add one. ')):(c(),y("div",Mt,[(c(!0),y(P,null,Z(z.value,(s,B)=>(c(),y("div",{key:B,class:"border rounded-md"},[a(me,{open:Y.value[B],"onUpdate:open":u=>Y.value[B]=u,class:"w-full"},{content:d(()=>[l("div",Nt,[l("div",Pt,[l("div",jt,[a(V,{label:"Type"},{default:d(()=>[a(D,{modelValue:s.type,"onUpdate:modelValue":u=>s.type=u,items:[{label:"Regular Index",value:"INDEX"},{label:"Unique Index",value:"UNIQUE"}],disabled:p.value,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024),a(V,{label:"Column"},{default:d(()=>[a(D,{modelValue:s.column,"onUpdate:modelValue":u=>s.column=u,items:n.value.map(u=>({label:u.name,value:u.name})),disabled:p.value||n.value.length===0,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","items","disabled"])]),_:2},1024)])])])]),default:d(()=>[l("div",Lt,[a(C,{class:"group flex-1 flex items-center justify-between p-3 text-left w-full",color:"neutral",variant:"ghost","trailing-icon":"i-lucide-settings-2",ui:{trailingIcon:"group-data-[state=open]:rotate-90 transition-transform duration-200"}},{default:d(()=>[l("div",Bt,[l("div",At,T(s.type)+" on "+T(s.column),1)])]),_:2},1024),a(C,{color:"error",variant:"ghost",icon:"i-lucide-trash-2",size:"sm",class:"mr-2",onClick:u=>re(B),disabled:p.value},null,8,["onClick","disabled"])])]),_:2},1032,["open","onUpdate:open"])]))),128))]))])]),"foreign-keys-tab":d(()=>[l("div",Ft,[l("div",Rt,[e[9]||(e[9]=l("h3",{class:"text-sm font-medium"},"Foreign Keys",-1)),a(C,{size:"xs",color:"neutral",variant:"soft",icon:"i-lucide-plus",onClick:ie,disabled:p.value||!ze.value},{default:d(()=>e[8]||(e[8]=[X(" Add Foreign Key ")])),_:1,__:[8]},8,["disabled"])]),L.value.length===0?(c(),y("div",qt,' No foreign keys added yet. Click "Add Foreign Key" to add one. ')):(c(),y("div",Dt,[(c(!0),y(P,null,Z(L.value,(s,B)=>(c(),y("div",{key:B,class:"border rounded-md"},[a(me,{open:R.value[B],"onUpdate:open":u=>R.value[B]=u,class:"w-full"},{content:d(()=>[l("div",Yt,[l("div",Gt,[a(V,{label:"Column"},{default:d(()=>[a(D,{modelValue:s.column,"onUpdate:modelValue":u=>s.column=u,items:n.value.map(u=>({label:u.name,value:u.name})),disabled:p.value||n.value.length===0,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","items","disabled"])]),_:2},1024),a(V,{label:"References Table"},{default:d(()=>[a(D,{modelValue:s.on,"onUpdate:modelValue":[u=>s.on=u,u=>Ee(u,B)],items:k.value,placeholder:"Select referenced table",disabled:p.value||k.value.length===0,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","items","disabled"])]),_:2},1024),a(V,{label:"References Column"},{default:d(()=>{var u,he;return[a(D,{modelValue:s.references,"onUpdate:modelValue":Ae=>s.references=Ae,items:((u=N.value[s.on])==null?void 0:u.columns)||[],loading:(he=N.value[s.on])==null?void 0:he.isLoading,disabled:p.value||!s.on,placeholder:s.on?"Select column":"Select table first","loading-icon":"i-lucide-loader-2",class:"w-full"},null,8,["modelValue","onUpdate:modelValue","items","loading","disabled","placeholder"])]}),_:2},1024)])])]),default:d(()=>[l("div",Kt,[a(C,{class:"group flex-1 flex items-center justify-between p-3 text-left",color:"neutral",variant:"ghost","trailing-icon":"i-lucide-settings-2",ui:{trailingIcon:"group-data-[state=open]:rotate-90 transition-transform duration-200"}},{default:d(()=>[l("div",Ht,[l("div",Ot,T(s.column)+" → "+T(s.on)+"."+T(s.references),1)])]),_:2},1024),a(C,{color:"error",variant:"ghost",icon:"i-lucide-trash-2",size:"sm",class:"mr-2",onClick:u=>ue(B),disabled:p.value},null,8,["onClick","disabled"])])]),_:2},1032,["open","onUpdate:open"])]))),128))]))])]),_:1},8,["items"])])],32)])]),footer:d(()=>[l("div",Qt,[a(C,{color:"neutral",variant:"soft",onClick:ee,disabled:p.value,label:"Cancel"},null,8,["disabled"]),a(C,{type:"button",color:"primary",loading:p.value,disabled:!F.value||p.value,onClick:Q,label:"Create Table"},null,8,["loading","disabled"])])]),_:1},8,["open","title"]),a(De,{open:_.value,"onUpdate:open":e[2]||(e[2]=s=>_.value=s),ModalTitle:"Unsaved Changes",ModalContent:"You have unsaved changes to the table structure. Closing without saving will discard these changes.",ModalConfirmText:"Discard Changes",ModalCancelText:"Continue Editing",onConfirm:te,onClose:e[3]||(e[3]=s=>_.value=!1)},null,8,["open"])],64)}}}),Zt={slots:{root:"flex items-center align-center text-center",border:"",container:"font-medium text-default flex",icon:"shrink-0 size-5",avatar:"shrink-0",avatarSize:"2xs",label:"text-sm"},variants:{color:{primary:{border:"border-primary"},secondary:{border:"border-secondary"},success:{border:"border-success"},info:{border:"border-info"},warning:{border:"border-warning"},error:{border:"border-error"},neutral:{border:"border-default"}},orientation:{horizontal:{root:"w-full flex-row",border:"w-full",container:"mx-3 whitespace-nowrap"},vertical:{root:"h-full flex-col",border:"h-full",container:"my-2"}},size:{xs:"",sm:"",md:"",lg:"",xl:""},type:{solid:{border:"border-solid"},dashed:{border:"border-dashed"},dotted:{border:"border-dotted"}}},compoundVariants:[{orientation:"horizontal",size:"xs",class:{border:"border-t"}},{orientation:"horizontal",size:"sm",class:{border:"border-t-[2px]"}},{orientation:"horizontal",size:"md",class:{border:"border-t-[3px]"}},{orientation:"horizontal",size:"lg",class:{border:"border-t-[4px]"}},{orientation:"horizontal",size:"xl",class:{border:"border-t-[5px]"}},{orientation:"vertical",size:"xs",class:{border:"border-s"}},{orientation:"vertical",size:"sm",class:{border:"border-s-[2px]"}},{orientation:"vertical",size:"md",class:{border:"border-s-[3px]"}},{orientation:"vertical",size:"lg",class:{border:"border-s-[4px]"}},{orientation:"vertical",size:"xl",class:{border:"border-s-[5px]"}}],defaultVariants:{color:"neutral",size:"xs",type:"solid"}},Jt={__name:"Separator",props:{as:{type:null,required:!1},label:{type:String,required:!1},icon:{type:String,required:!1},avatar:{type:Object,required:!1},color:{type:null,required:!1},size:{type:null,required:!1},type:{type:null,required:!1},orientation:{type:null,required:!1,default:"horizontal"},class:{type:null,required:!1},ui:{type:null,required:!1},decorative:{type:Boolean,required:!1}},setup(f){const o=f,x=Je(),_=tt(),v=We(et(o,"as","decorative","orientation")),$=U(()=>{var b;return ye({extend:ye(Zt),...((b=_.ui)==null?void 0:b.separator)||{}})({color:o.color,orientation:o.orientation,size:o.size,type:o.type})});return(b,r)=>{var m;return c(),j(M(ft),ve(M(v),{class:$.value.root({class:[(m=o.ui)==null?void 0:m.root,o.class]})}),{default:d(()=>{var S,p,I;return[l("div",{class:H($.value.border({class:(S=o.ui)==null?void 0:S.border}))},null,2),f.label||f.icon||f.avatar||x.default?(c(),y(P,{key:0},[l("div",{class:H($.value.container({class:(p=o.ui)==null?void 0:p.container}))},[fe(b.$slots,"default",{},()=>{var E,n,z,L;return[f.label?(c(),y("span",{key:0,class:H($.value.label({class:(E=o.ui)==null?void 0:E.label}))},T(f.label),3)):f.icon?(c(),j(be,{key:1,name:f.icon,class:H($.value.icon({class:(n=o.ui)==null?void 0:n.icon}))},null,8,["name","class"])):f.avatar?(c(),j(at,ve({key:2,size:((z=o.ui)==null?void 0:z.avatarSize)||$.value.avatarSize()},f.avatar,{class:$.value.avatar({class:(L=o.ui)==null?void 0:L.avatar})}),null,16,["size","class"])):le("",!0)]})],2),l("div",{class:H($.value.border({class:(I=o.ui)==null?void 0:I.border}))},null,2)],64)):le("",!0)]}),_:3},16,["class"])}}};function Wt(){const f=w({}),o=w({}),x=w({}),_=async b=>{if(f.value[b]&&!x.value[b])return f.value[b];o.value[b]=!0,x.value[b]="";try{const r=await lt.db.getTableMetadata(b),m={name:b,rowCount:r.data.rows,size:v(r.data.size),sizeBytes:r.data.size,lastModified:r.data.updated||r.data.created||new Date().toISOString(),columns:r.data.columns,indexes:r.data.indexes,engine:r.data.engine};return f.value[b]=m,m}catch(r){return x.value[b]=r.message||"Failed to fetch metadata",null}finally{o.value[b]=!1}},v=b=>{if(b===0)return"0 Bytes";const r=1024,m=["Bytes","KB","MB","GB","TB"],S=Math.floor(Math.log(b)/Math.log(r));return parseFloat((b/Math.pow(r,S)).toFixed(2))+" "+m[S]};return{metadata:f,loading:o,errors:x,fetchTableMetadata:_,clearCache:()=>{f.value={},x.value={}}}}const ea={class:"p-3 min-w-[280px]"},ta={key:0,class:"space-y-2"},aa={key:1,class:"text-red-500 text-sm"},la={key:2,class:"space-y-2"},sa={class:"flex items-center justify-between"},oa={class:"text-sm font-semibold"},na={class:"space-y-1 text-sm"},ra={class:"flex justify-between"},ia={class:"font-medium"},ua={class:"flex justify-between"},da={class:"font-medium"},ca={class:"flex justify-between"},ma={class:"font-medium"},pa={class:"flex justify-between"},va={class:"font-medium"},fa={class:"text-xs text-gray-500"},ba={key:3,class:"text-gray-500 text-sm"},ha=O({__name:"TablePreview",props:{tableName:{}},setup(f){const o=f,{fetchTableMetadata:x,loading:_}=Wt(),v=w(null),$=w("");$e(async()=>{try{v.value=await x(o.tableName)}catch(r){$.value=r.message||"Failed to load metadata"}});const b=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A";return(r,m)=>{var E;const S=Ie,p=Se,I=Jt;return c(),y("div",ea,[M(_)[r.tableName]?(c(),y("div",ta,[a(S,{class:"h-4 w-32"}),a(S,{class:"h-4 w-24"}),a(S,{class:"h-4 w-28"})])):$.value?(c(),y("div",aa,T($.value),1)):v.value?(c(),y("div",la,[l("div",sa,[l("span",oa,T(r.tableName),1),v.value.engine?(c(),j(p,{key:0,variant:"soft",size:"xs"},{default:d(()=>[X(T(v.value.engine),1)]),_:1})):le("",!0)]),l("div",na,[l("div",ra,[m[0]||(m[0]=l("span",{class:"text-gray-500"},"Rows:",-1)),l("span",ia,T(((E=v.value.rowCount)==null?void 0:E.toLocaleString())||"0"),1)]),l("div",ua,[m[1]||(m[1]=l("span",{class:"text-gray-500"},"Size:",-1)),l("span",da,T(v.value.size||"0 Bytes"),1)]),l("div",ca,[m[2]||(m[2]=l("span",{class:"text-gray-500"},"Columns:",-1)),l("span",ma,T(v.value.columns||"0"),1)]),l("div",pa,[m[3]||(m[3]=l("span",{class:"text-gray-500"},"Indexes:",-1)),l("span",va,T(v.value.indexes||"0"),1)]),a(I,{class:"my-1"}),l("div",fa," Last modified: "+T(b(v.value.lastModified)),1)])])):(c(),y("div",ba,"No metadata available"))])}}}),_a={class:"space-y-1"},ga=O({__name:"TableListSkeleton",props:{itemCount:{default:8}},setup(f){return(o,x)=>{const _=Ie;return c(),y("div",_a,[(c(!0),y(P,null,Z(o.itemCount,v=>(c(),y("div",{key:v,class:"flex items-center px-4 py-3"},[a(_,{class:"h-4 w-4 mr-2",ui:{rounded:"rounded"}}),a(_,{class:"h-4 flex-1 max-w-[180px]"}),a(_,{class:"h-6 w-6 ml-auto opacity-50",ui:{rounded:"rounded-full"}})]))),128))])}}});function ya(f,o){const{itemHeight:x,buffer:_=3}=o,v=w(0),$=typeof o.containerHeight=="number"?w(o.containerHeight):o.containerHeight,b=U(()=>Math.ceil($.value/x)+_*2),r=U(()=>Math.max(0,Math.floor(v.value/x)-_)),m=U(()=>Math.min(f.value.length,r.value+b.value+1)),S=U(()=>f.value.slice(r.value,m.value)),p=U(()=>f.value.length*x),I=U(()=>r.value*x);return{visibleItems:S,totalHeight:p,offsetY:I,onScroll:n=>{const z=n.target;v.value=z.scrollTop},startIndex:r,endIndex:m}}const xa={class:"flex items-center"},wa={class:"px-4 py-2"},Ca={key:1,class:"p-4 text-red-500"},Ta={key:2,class:"p-4 text-center text-gray-500"},$a={class:"flex items-center h-full"},Va={class:"flex-1"},Ua=O({__name:"tables",setup(f){const o=Ue(),x=w(!0),_=w(!1),v=st(),$=ot(),b=pt(),r=w(),m=w(""),S=w(),p=w(-1),I=w(600),E=U(()=>o.tables||[]),n=U(()=>{if(!m.value)return E.value;const h=m.value.toLowerCase();return E.value.filter(g=>g.toLowerCase().includes(h))}),z=()=>{r.value&&(I.value=r.value.clientHeight)},{visibleItems:L,totalHeight:A,offsetY:Y,onScroll:R}=ya(n,{itemHeight:48,containerHeight:I,buffer:8}),F=U(()=>{const h=$.path.match(/\/tables\/(.+)/);return h?h[1]:null}),se=h=>{if(h>=0&&h<n.value.length){p.value=h;const g=n.value[h];v.push(`/tables/${g}`)}},G=h=>{const g=F.value?n.value.indexOf(F.value):-1;let q=h==="up"?Math.max(0,g-1):Math.min(n.value.length-1,g+1);g===-1&&n.value.length>0&&(q=0),se(q)};Oe({shift_t:{usingInput:!1,handler:()=>{_.value=!0}},meta_f:{usingInput:!1,handler:()=>{var h;(h=S.value)==null||h.focus()}},arrowup:{usingInput:!1,handler:()=>{G("up")}},arrowdown:{usingInput:!1,handler:()=>{G("down")}},escape:{usingInput:!0,handler:()=>{var h;_.value?_.value=!1:m.value&&(m.value="",(h=S.value)==null||h.blur())}}}),$e(async()=>{var h;x.value=!0,await o.fetchTables(),x.value=!1,z(),window.addEventListener("resize",z),((h=o.tables)==null?void 0:h.length)>0&&v.currentRoute.value.path==="/tables"&&v.push(`/tables/${o.tables[0]}`)}),nt(()=>{window.removeEventListener("resize",z)});const J=async h=>{try{console.log("Creating table:",h),(await o.createTable(h)).success&&(await o.fetchTables(),b.success({title:"Table Created",description:`Table ${h.table_name} created successfully.`}),o.tables.includes(h.table_name)&&v.push(`/tables/${h.table_name}`))}catch(g){console.error("Error creating table:",g),b.error({title:"Table Creation Failed",description:g.message||"An error occurred while creating the table"})}};return(h,g)=>{const q=Se,W=Ce,oe=mt,ne=Ve,re=ga,ie=be,ue=ha,ee=ct,te=it,Q=dt,ae=rt("RouterView"),de=Xt;return c(),y(P,null,[a(Q,{id:"tables-list","default-size":15,"min-size":15,"max-size":25},{default:d(()=>[a(oe,{title:"Tables"},{left:d(()=>[l("div",xa,[g[6]||(g[6]=l("span",null,"Tables",-1)),x.value?le("",!0):(c(),j(q,{key:0,class:"ml-2",variant:"soft"},{default:d(()=>[X(T(n.value.length),1)]),_:1}))])]),right:d(()=>[a(W,{size:"sm",color:"primary",icon:"i-lucide-plus",onClick:g[0]||(g[0]=k=>_.value=!0)})]),_:1}),l("div",wa,[a(ne,{ref_key:"searchInput",ref:S,modelValue:m.value,"onUpdate:modelValue":g[1]||(g[1]=k=>m.value=k),placeholder:"Search tables...",icon:"i-lucide-search",class:"w-full"},null,8,["modelValue"])]),l("div",{ref_key:"tablesContainer",ref:r,class:"overflow-y-auto relative",style:{height:"calc(100% - 120px)"},onScroll:g[3]||(g[3]=(...k)=>M(R)&&M(R)(...k))},[x.value?(c(),j(re,{key:0,"item-count":10})):M(o).dbError?(c(),y("div",Ca,T(M(o).dbError),1)):M(o).tables&&!n.value.length?(c(),y("div",Ta,T(m.value?"No tables match your search":"No tables found"),1)):(c(),y("div",{key:3,class:"relative",style:xe({height:`${M(A)}px`})},[l("div",{class:"absolute top-0 left-0 right-0",style:xe({transform:`translateY(${M(Y)}px)`})},[(c(!0),y(P,null,Z(M(L),k=>(c(),y("div",{key:k,class:"relative"},[a(te,{to:`/tables/${k}`,class:H(["block px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-800 text-base group",{"bg-primary-50 dark:bg-primary-900 font-medium":F.value===k,"text-gray-700 dark:text-gray-300":F.value!==k}]),style:{height:"48px"}},{default:d(()=>[l("div",$a,[a(ie,{name:"i-lucide-table-2",class:"mr-2 flex-shrink-0"}),l("div",Va,T(k),1),a(ee,{popper:{placement:"right",offsetDistance:8},mode:"hover"},{content:d(()=>[a(ue,{"table-name":k},null,8,["table-name"])]),default:d(()=>[a(W,{icon:"i-lucide-info",size:"xs",variant:"ghost",color:"neutral",class:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:g[2]||(g[2]=Te(()=>{},["stop","prevent"]))})]),_:2},1024)])]),_:2},1032,["to","class"])]))),128))],4)],4))],544)]),_:1}),a(Q,{id:"table-details"},{default:d(()=>[a(ae)]),_:1}),a(de,{open:_.value,"onUpdate:open":g[4]||(g[4]=k=>_.value=k),slideoverTitle:"Create New Table",onSubmit:J,onClose:g[5]||(g[5]=k=>_.value=!1)},null,8,["open"])],64)}}});typeof we=="function"&&we(Ua);export{Ua as default};
