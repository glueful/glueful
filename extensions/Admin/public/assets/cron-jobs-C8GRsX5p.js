import{_ as ee,b as B}from"./route-block-BD734aAn.js";import{_ as F}from"./Badge-AijS7S0U.js";import{_ as te}from"./Table-DpZO3-jS.js";import{_ as se}from"./TableDataSkeleton.vue_vue_type_script_setup_true_lang-CYjHPP2B.js";import{_ as ne}from"./Card-kWGpn_Iq.js";import{d as oe,r as m,f as v,A as ae,i as C,o as r,j as o,Z as t,k as n,z as E,B as x,F as R,ai as I,O as i,al as le,au as p,ah as ie,N as y,as as N}from"./index-CRsdYi2H.js";import{_ as re}from"./CardSkeleton.vue_vue_type_script_setup_true_lang-BrFFxJWG.js";import{_ as ce}from"./DashboardNavbar.vue_vue_type_script_setup_true_lang-BjOyJKj1.js";import{_ as K}from"./Checkbox-D3Mbv2b_.js";import{u as ue}from"./useToastNotification-BcotWXPZ.js";import"./DashboardResizeHandle.vue_vue_type_script_setup_true_lang-BBA6ihDY.js";import"./DashboardSidebarToggle.vue_vue_type_script_setup_true_lang-DsgFYwLG.js";import"./index-88opOQSr.js";import"./Skeleton-D_IVtAoi.js";import"./useDirection-k4nYEygm.js";import"./isValueEqualOrExist-BBQ1z4Lv.js";import"./useFormControl-NdRzoGR7.js";import"./RovingFocusItem-h949RZXv.js";import"./RovingFocusGroup-BBmQv82t.js";import"./VisuallyHiddenInput-C3uj9iqK.js";import"./Label-PeVd4_oV.js";const de={key:0,class:"flex items-center gap-2"},me={class:"text-sm text-gray-600"},xe={class:"space-y-6"},ge={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},fe={class:"flex items-center justify-between"},_e={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},ve={class:"flex items-center justify-between"},pe={class:"text-2xl font-bold text-green-600 dark:text-green-400"},ye={class:"flex items-center justify-between"},be={class:"text-2xl font-bold text-gray-600 dark:text-gray-400"},he={class:"flex items-center justify-between"},ke={class:"text-2xl font-bold text-orange-600 dark:text-orange-400"},we={class:"flex items-center justify-between"},Je={class:"text-sm text-gray-500"},Ce={key:1,class:"py-8 text-center text-red-600 dark:text-red-400"},Se={key:2,class:"py-12 text-center text-gray-500"},De={key:3},Re={class:"py-12 text-center text-gray-500"},Ne={class:"flex items-center justify-between"},je={class:"space-y-2"},Ve={class:"flex items-center gap-3"},$e={class:"font-medium text-sm"},Ae={class:"text-xs text-gray-600 dark:text-gray-400 font-mono"},Ue={class:"text-xs text-gray-500"},Te={class:"flex items-center gap-2"},ze={class:"flex items-center justify-between"},Be={class:"text-center py-8"},Fe={class:"text-gray-600 dark:text-gray-400"},Ee=oe({__name:"cron-jobs",setup(Ie){const g=m(!1),S=m(!1),h=m(!1),k=m(null),c=m([]),f=ue(),w=m({}),j=m([]),V=m({}),P=v(()=>c.value.filter(s=>s.status==="active"||s.status==="enabled")),L=v(()=>c.value.filter(s=>s.status==="inactive"||s.status==="disabled")),$=v(()=>{const s=new Date;return c.value.filter(e=>e.next_run?new Date(e.next_run)<=s&&(e.status==="active"||e.status==="enabled"):!1)}),O=v(()=>P.value.length),H=v(()=>L.value.length),b=v(()=>$.value.length),M=[{id:"select",header:({table:s})=>p(K,{modelValue:s.getIsAllPageRowsSelected(),"onUpdate:modelValue":e=>s.toggleAllPageRowsSelected(!!e),indeterminate:s.getIsSomePageRowsSelected()}),cell:({row:s})=>p(K,{modelValue:s.getIsSelected(),"onUpdate:modelValue":e=>s.toggleSelected(!!e)}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Job Name",cell:({row:s})=>{const e=s.getValue("name");return p("div",{class:"font-medium text-sm",title:e},e)},enableSorting:!0},{accessorKey:"status",header:"Status",cell:({row:s})=>{const e=s.getValue("status"),a=e==="active"||e==="enabled";return p(F,{color:a?"green":"gray",variant:"subtle"},()=>a?"Active":"Inactive")},enableSorting:!0},{accessorKey:"command",header:"Command",cell:({row:s})=>{const e=s.getValue("command");return p("div",{class:"max-w-xs truncate text-xs text-gray-600 font-mono",title:e},e)},enableSorting:!1},{accessorKey:"next_run",header:"Next Run",cell:({row:s})=>{const e=s.getValue("next_run");return e?p("span",{class:"text-xs font-mono"},D(e)):"â€”"},enableSorting:!0},{accessorKey:"last_run",header:"Last Run",cell:({row:s})=>{const e=s.getValue("last_run");return e?p("span",{class:"text-xs font-mono"},D(e)):"Never"},enableSorting:!0},{id:"action"}],D=s=>new Date(s).toLocaleString();async function J(){var s;g.value=!0,k.value=null;try{const e=await N.jobs.getAllJobs();if(e.success){const a=Array.isArray(e.data)?e.data:((s=e.data)==null?void 0:s.jobs)||[];c.value=a.map(d=>({id:d.id,name:d.name,command:d.command,next_run:d.next_run,last_run:d.last_run,status:d.status}))}}catch(e){const a=e;k.value=a.message||"Failed to fetch jobs",f.error({title:"Error",description:k.value})}finally{g.value=!1}}async function A(s){S.value=!0;try{const e=await N.jobs.runJob(s);e.success&&(f.success({title:"Job Executed",description:e.data.message||`Job ${s} executed successfully.`}),await J())}catch(e){const a=e;f.error({title:"Job Execution Failed",description:a.message||"Failed to run job"})}finally{S.value=!1}}async function U(){if(b.value===0){f.warn({title:"No Due Jobs",description:"There are no jobs currently due for execution."});return}h.value=!0;try{const s=await N.jobs.runDueJobs();if(s.success){const e=s.data.executed||0;f.success({title:"Jobs Executed",description:`Successfully executed ${e} job(s).`}),await J()}}catch(s){const e=s;f.error({title:"Job Execution Failed",description:e.message||"Failed to run due jobs"})}finally{h.value=!1}}async function Z(){await J(),f.success({title:"Refreshed",description:"Job status updated."})}function q(){w.value={}}const T=v(()=>Object.keys(w.value).length);return ae(()=>{J()}),(s,e)=>{const a=ie,d=ce,G=re,u=le,_=ne,Q=se,W=te,z=F,X=ee;return r(),C(X,{id:"cron-jobs"},{header:o(()=>[n(d,{title:"Cron Jobs"},{right:o(()=>[T.value>0?(r(),x("div",de,[t("span",me,i(T.value)+" selected",1),n(a,{variant:"ghost",size:"sm",icon:"i-heroicons-x-mark",onClick:q},{default:o(()=>e[3]||(e[3]=[y(" Clear ")])),_:1,__:[3]})])):E("",!0),n(a,{color:"primary",size:"sm",icon:"i-heroicons-play",loading:h.value,disabled:b.value===0||h.value,onClick:U},{default:o(()=>[y(" Run Due Jobs ("+i(b.value)+") ",1)]),_:1},8,["loading","disabled"]),n(a,{variant:"ghost",icon:"i-heroicons-arrow-path",loading:g.value,onClick:Z,size:"sm"},null,8,["loading"])]),_:1})]),body:o(()=>[t("div",xe,[t("div",ge,[g.value?(r(),x(R,{key:0},I(4,l=>n(G,{key:`card-skeleton-${l}`,"show-header":!1,"show-image":!1,"line-count":0,"show-title":!1})),64)):(r(),x(R,{key:1},[n(_,null,{default:o(()=>[t("div",fe,[t("div",null,[e[4]||(e[4]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Total Jobs",-1)),t("p",_e,i(c.value.length),1)]),n(u,{name:"i-heroicons-clock",class:"h-8 w-8 text-blue-500"})])]),_:1}),n(_,null,{default:o(()=>[t("div",ve,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Active",-1)),t("p",pe,i(O.value),1)]),n(u,{name:"i-heroicons-check-circle",class:"h-8 w-8 text-green-500"})])]),_:1}),n(_,null,{default:o(()=>[t("div",ye,[t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Inactive",-1)),t("p",be,i(H.value),1)]),n(u,{name:"i-heroicons-pause-circle",class:"h-8 w-8 text-gray-500"})])]),_:1}),n(_,null,{default:o(()=>[t("div",he,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Due Now",-1)),t("p",ke,i(b.value),1)]),n(u,{name:"i-heroicons-exclamation-triangle",class:"h-8 w-8 text-orange-500"})])]),_:1})],64))]),n(_,null,{header:o(()=>[t("div",we,[e[8]||(e[8]=t("h3",{class:"text-lg font-medium"},"All Jobs",-1)),t("div",Je,i(c.value.length)+" total jobs",1)])]),default:o(()=>[g.value?(r(),C(Q,{key:0,"row-count":8,"column-count":7})):k.value?(r(),x("div",Ce,[n(u,{name:"i-heroicons-exclamation-triangle",class:"text-2xl mb-2"}),t("p",null,i(k.value),1)])):c.value.length===0?(r(),x("div",Se,[n(u,{name:"i-heroicons-clock",class:"text-4xl mb-2"}),e[9]||(e[9]=t("p",null,"No jobs found",-1))])):(r(),x("div",De,[n(W,{"row-selection":w.value,"onUpdate:rowSelection":e[0]||(e[0]=l=>w.value=l),sorting:j.value,"onUpdate:sorting":e[1]||(e[1]=l=>j.value=l),"column-visibility":V.value,"onUpdate:columnVisibility":e[2]||(e[2]=l=>V.value=l),columns:M,data:c.value,loading:g.value,sticky:"",class:"w-full",ui:{th:"px-4 py-3.5 text-sm text-highlighted text-left rtl:text-right font-semibold whitespace-nowrap"}},{"action-cell":o(({row:l})=>[n(a,{variant:"ghost",size:"sm",icon:"i-heroicons-play",onClick:Y=>A(l.original.name)},{default:o(()=>e[10]||(e[10]=[y(" Run ")])),_:2,__:[10]},1032,["onClick"])]),empty:o(()=>[t("div",Re,[n(u,{name:"i-heroicons-clock",class:"text-4xl mb-2"}),e[11]||(e[11]=t("p",null,"No jobs found",-1))])]),_:1},8,["row-selection","sorting","column-visibility","data","loading"])]))]),_:1}),b.value>0?(r(),C(_,{key:0},{header:o(()=>[t("div",Ne,[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-orange-600 dark:text-orange-400"},"Jobs Due Now",-1)),n(z,{color:"warning",variant:"subtle"},{default:o(()=>[y(i(b.value)+" due",1)]),_:1})])]),footer:o(()=>[t("div",ze,[e[16]||(e[16]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," These jobs are currently due for execution. ",-1)),n(a,{color:"warning",variant:"outline",size:"sm",icon:"i-heroicons-play",loading:h.value,onClick:U},{default:o(()=>e[15]||(e[15]=[y(" Run All Due ")])),_:1,__:[15]},8,["loading"])])]),default:o(()=>[t("div",je,[(r(!0),x(R,null,I($.value,l=>(r(),x("div",{key:l.id,class:"flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800"},[t("div",Ve,[n(u,{name:"i-heroicons-exclamation-triangle",class:"text-orange-500"}),t("div",null,[t("p",$e,i(l.name),1),t("p",Ae,i(l.command),1),t("p",Ue,"Due: "+i(D(l.next_run)),1)])]),t("div",Te,[n(z,{color:"warning",variant:"subtle"},{default:o(()=>e[13]||(e[13]=[y("Due")])),_:1,__:[13]}),n(a,{variant:"outline",size:"sm",icon:"i-heroicons-play",loading:S.value,onClick:Y=>A(l.name)},{default:o(()=>e[14]||(e[14]=[y(" Run ")])),_:2,__:[14]},1032,["loading","onClick"])])]))),128))])]),_:1})):c.value.length>0&&!g.value?(r(),C(_,{key:1},{default:o(()=>[t("div",Be,[n(u,{name:"i-heroicons-check-circle",class:"text-6xl text-green-500 mb-4"}),e[17]||(e[17]=t("h3",{class:"text-lg font-medium text-green-600 dark:text-green-400 mb-2"}," All Jobs Up to Date ",-1)),t("p",Fe," No jobs are currently due for execution. "+i(c.value.length)+" jobs are scheduled. ",1)])]),_:1})):E("",!0)])]),_:1})}}});typeof B=="function"&&B(Ee);export{Ee as default};
