import{_ as J,b as B}from"./route-block-BD734aAn.js";import{_ as D}from"./Badge-AijS7S0U.js";import{_ as Q}from"./Table-DpZO3-jS.js";import{_ as W}from"./TableDataSkeleton.vue_vue_type_script_setup_true_lang-CYjHPP2B.js";import{_ as X}from"./Card-kWGpn_Iq.js";import{d as ee,r as u,f as S,au as h,A as te,i as M,o as l,j as n,Z as t,k as s,z as F,B as m,F as P,ai as z,O as d,al as ae,N as b,ah as se,as as V}from"./index-CRsdYi2H.js";import{_ as ne}from"./CardSkeleton.vue_vue_type_script_setup_true_lang-BrFFxJWG.js";import{_ as oe}from"./DashboardNavbar.vue_vue_type_script_setup_true_lang-BjOyJKj1.js";import{_ as I}from"./Checkbox-D3Mbv2b_.js";import{u as ie}from"./useToastNotification-BcotWXPZ.js";import"./DashboardResizeHandle.vue_vue_type_script_setup_true_lang-BBA6ihDY.js";import"./DashboardSidebarToggle.vue_vue_type_script_setup_true_lang-DsgFYwLG.js";import"./index-88opOQSr.js";import"./Skeleton-D_IVtAoi.js";import"./useDirection-k4nYEygm.js";import"./isValueEqualOrExist-BBQ1z4Lv.js";import"./useFormControl-NdRzoGR7.js";import"./RovingFocusItem-h949RZXv.js";import"./RovingFocusGroup-BBmQv82t.js";import"./VisuallyHiddenInput-C3uj9iqK.js";import"./Label-PeVd4_oV.js";const le={key:0,class:"flex items-center gap-2"},re={class:"text-sm text-gray-600"},de={class:"space-y-6"},ce={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ue={class:"flex items-center justify-between"},me={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},pe={class:"flex items-center justify-between"},ge={class:"text-2xl font-bold text-green-600 dark:text-green-400"},fe={class:"flex items-center justify-between"},_e={class:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"},xe={class:"flex items-center justify-between"},ye={class:"text-sm text-gray-500"},ve={key:1,class:"py-8 text-center text-red-600 dark:text-red-400"},he={key:2,class:"py-12 text-center text-gray-500"},be={key:3},we={class:"py-12 text-center text-gray-500"},ke={class:"flex items-center justify-between"},Se={class:"space-y-2"},Me={class:"flex items-center gap-3"},Ae={class:"font-mono text-sm font-medium"},Ce={class:"text-xs text-gray-600 dark:text-gray-400 font-mono"},Pe={class:"flex items-center justify-between"},Ve={class:"text-center py-8"},Re={class:"text-gray-600 dark:text-gray-400"},Ne=ee({__name:"migrations",setup($e){const p=u(!1),w=u(!1),k=u(null),g=u([]),A=u([]),f=ie(),_=u({}),R=u([]),N=u({}),K=S(()=>g.value.filter(a=>a.applied)),x=S(()=>A.value.length),$=S(()=>K.value.length),O=S(()=>[{id:"select",header:({table:a})=>h(I,{modelValue:a.getIsAllPageRowsSelected(),"onUpdate:modelValue":e=>a.toggleAllPageRowsSelected(!!e),indeterminate:a.getIsSomePageRowsSelected()}),cell:({row:a})=>h(I,{modelValue:a.getIsSelected(),"onUpdate:modelValue":e=>a.toggleSelected(!!e),disabled:a.original.applied}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Migration Name",cell:({row:a})=>{const e=a.getValue("name");return h("div",{class:"font-mono text-sm",title:e},e)},enableSorting:!0},{accessorKey:"applied",header:"Status",cell:({row:a})=>{const e=a.getValue("applied");return h(D,{color:e?"green":"yellow",variant:"subtle"},()=>e?"Applied":"Pending")},enableSorting:!0},{accessorKey:"batch",header:"Batch",cell:({row:a})=>a.getValue("batch")||"—",enableSorting:!0},{accessorKey:"applied_at",header:"Applied At",cell:({row:a})=>{const e=a.getValue("applied_at");return e?h("span",{class:"text-xs font-mono"},E(e)):"—"},enableSorting:!0},{accessorKey:"path",header:"File Path",cell:({row:a})=>{const e=a.getValue("path");return h("div",{class:"max-w-xs truncate text-xs text-gray-600 font-mono",title:e},e)},enableSorting:!1}]),E=a=>new Date(a).toLocaleString();async function C(){var a,e;p.value=!0,k.value=null;try{const[i,y]=await Promise.all([V.migrations.getAllMigrations(),V.migrations.getPendingMigrations()]);if(i.success){const c=Array.isArray(i.data)?i.data:((a=i.data)==null?void 0:a.migrations)||[];g.value=c.map(o=>({name:o.migration||o.name,path:o.migration||o.path||o.name,batch:o.batch,applied:!0,applied_at:o.applied_at,description:o.description}))}y.success&&(A.value=(((e=y.data)==null?void 0:e.migrations)||[]).map(c=>({name:c.name||c.migration,path:c.path||c.migration,applied:!1})))}catch(i){const y=i;k.value=y.message||"Failed to fetch migrations",f.error({title:"Error",description:k.value})}finally{p.value=!1}}async function j(){var a;if(x.value===0){f.warn({title:"No Pending Migrations",description:"There are no pending migrations to run."});return}w.value=!0;try{const e=await V.migrations.runPendingMigrations();if(e.success){const i=((a=e.data.applied)==null?void 0:a.length)||0;f.success({title:"Migrations Applied",description:`Successfully applied ${i} migration(s).`}),await C()}}catch(e){const i=e;f.error({title:"Migration Failed",description:i.message||"Failed to run migrations"})}finally{w.value=!1}}async function L(){if(Object.keys(_.value).filter(e=>_.value[e]).length===0){f.warn({title:"No Migrations Selected",description:"Please select migrations to run."});return}f.info({title:"Feature Coming Soon",description:"Individual migration selection will be available in a future update."})}async function H(){await C(),f.success({title:"Refreshed",description:"Migration status updated."})}function Y(){_.value={}}const U=S(()=>Object.keys(_.value).length);return te(()=>{C()}),(a,e)=>{const i=se,y=oe,c=ne,o=ae,v=X,Z=W,q=Q,T=D,G=J;return l(),M(G,{id:"migrations"},{header:n(()=>[s(y,{title:"Database Migrations"},{right:n(()=>[U.value>0?(l(),m("div",le,[t("span",re,d(U.value)+" selected",1),s(i,{variant:"outline",size:"sm",icon:"i-heroicons-play",onClick:L},{default:n(()=>e[3]||(e[3]=[b(" Run Selected ")])),_:1,__:[3]}),s(i,{variant:"ghost",size:"sm",icon:"i-heroicons-x-mark",onClick:Y},{default:n(()=>e[4]||(e[4]=[b(" Clear ")])),_:1,__:[4]})])):F("",!0),s(i,{color:"primary",size:"sm",icon:"i-heroicons-play",loading:w.value,disabled:x.value===0||w.value,onClick:j},{default:n(()=>[b(" Run All Pending ("+d(x.value)+") ",1)]),_:1},8,["loading","disabled"]),s(i,{variant:"ghost",icon:"i-heroicons-arrow-path",loading:p.value,onClick:H,size:"sm"},null,8,["loading"])]),_:1})]),body:n(()=>[t("div",de,[t("div",ce,[p.value?(l(),m(P,{key:0},z(3,r=>s(c,{key:`card-skeleton-${r}`,"show-header":!1,"show-image":!1,"line-count":0,"show-title":!1})),64)):(l(),m(P,{key:1},[s(v,null,{default:n(()=>[t("div",ue,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Total Migrations",-1)),t("p",me,d(g.value.length),1)]),s(o,{name:"i-heroicons-document-text",class:"h-8 w-8 text-blue-500"})])]),_:1}),s(v,null,{default:n(()=>[t("div",pe,[t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Applied",-1)),t("p",ge,d($.value),1)]),s(o,{name:"i-heroicons-check-circle",class:"h-8 w-8 text-green-500"})])]),_:1}),s(v,null,{default:n(()=>[t("div",fe,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Pending",-1)),t("p",_e,d(x.value),1)]),s(o,{name:"i-heroicons-clock",class:"h-8 w-8 text-yellow-500"})])]),_:1})],64))]),s(v,null,{header:n(()=>[t("div",xe,[e[8]||(e[8]=t("h3",{class:"text-lg font-medium"},"All Migrations",-1)),t("div",ye,d(g.value.length)+" total migrations",1)])]),default:n(()=>[p.value?(l(),M(Z,{key:0,"row-count":8,"column-count":6})):k.value?(l(),m("div",ve,[s(o,{name:"i-heroicons-exclamation-triangle",class:"text-2xl mb-2"}),t("p",null,d(k.value),1)])):g.value.length===0?(l(),m("div",he,[s(o,{name:"i-heroicons-document-text",class:"text-4xl mb-2"}),e[9]||(e[9]=t("p",null,"No migrations found",-1))])):(l(),m("div",be,[s(q,{"row-selection":_.value,"onUpdate:rowSelection":e[0]||(e[0]=r=>_.value=r),sorting:R.value,"onUpdate:sorting":e[1]||(e[1]=r=>R.value=r),"column-visibility":N.value,"onUpdate:columnVisibility":e[2]||(e[2]=r=>N.value=r),columns:O.value,data:g.value,loading:p.value,sticky:"",class:"w-full",ui:{th:"px-4 py-3.5 text-sm text-highlighted text-left rtl:text-right font-semibold whitespace-nowrap"}},{empty:n(()=>[t("div",we,[s(o,{name:"i-heroicons-document-text",class:"text-4xl mb-2"}),e[10]||(e[10]=t("p",null,"No migrations found",-1))])]),_:1},8,["row-selection","sorting","column-visibility","columns","data","loading"])]))]),_:1}),x.value>0?(l(),M(v,{key:0},{header:n(()=>[t("div",ke,[e[11]||(e[11]=t("h3",{class:"text-lg font-medium text-yellow-600 dark:text-yellow-400"}," Pending Migrations ",-1)),s(T,{color:"warning",variant:"subtle"},{default:n(()=>[b(d(x.value)+" pending",1)]),_:1})])]),footer:n(()=>[t("div",Pe,[e[14]||(e[14]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," These migrations are ready to be applied to your database. ",-1)),s(i,{color:"warning",variant:"outline",size:"sm",icon:"i-heroicons-play",loading:w.value,onClick:j},{default:n(()=>e[13]||(e[13]=[b(" Run All Pending ")])),_:1,__:[13]},8,["loading"])])]),default:n(()=>[t("div",Se,[(l(!0),m(P,null,z(A.value,r=>(l(),m("div",{key:r.name,class:"flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800"},[t("div",Me,[s(o,{name:"i-heroicons-clock",class:"text-yellow-500"}),t("div",null,[t("p",Ae,d(r.name),1),t("p",Ce,d(r.path),1)])]),s(T,{color:"warning",variant:"subtle"},{default:n(()=>e[12]||(e[12]=[b("Pending")])),_:1,__:[12]})]))),128))])]),_:1})):g.value.length>0&&!p.value?(l(),M(v,{key:1},{default:n(()=>[t("div",Ve,[s(o,{name:"i-heroicons-check-circle",class:"text-6xl text-green-500 mb-4"}),e[15]||(e[15]=t("h3",{class:"text-lg font-medium text-green-600 dark:text-green-400 mb-2"}," All Migrations Applied ",-1)),t("p",Re," Your database is up to date. All "+d($.value)+" migrations have been applied. ",1)])]),_:1})):F("",!0)])]),_:1})}}});typeof B=="function"&&B(Ne);export{Ne as default};
