import{_ as pe,b as K}from"./route-block-C8UpW1tJ.js";import{_ as ge}from"./Pagination-CIUYPgU7.js";import{_ as ve}from"./Table-DfRn1MFI.js";import{d as H,B as m,o as d,i as C,z as k,Z as a,F as D,ai as E,k as s,r as g,f as N,av as v,ah as M,E as J,A as _e,j as n,N as f,aM as fe,am as ye,O as u,at as L}from"./index-CvplhhIg.js";import{_ as xe}from"./TableDataSkeleton.vue_vue_type_script_setup_true_lang-C_75FIk9.js";import{_ as he}from"./Card-3ffy2SwE.js";import{_ as be}from"./Select-BAUrMTbe.js";import{_ as ke}from"./FormField-VDwBeIdM.js";import{_ as we}from"./Input-C5IL3dmi.js";import{_ as Z}from"./Skeleton-BW74k3wi.js";import{_ as Se}from"./DashboardNavbar.vue_vue_type_script_setup_true_lang-DXiLQDGX.js";import{_ as Ve}from"./DropdownMenu-DWboWW_y.js";import{_ as T}from"./Badge-UswX4ZtY.js";import{_ as G}from"./Checkbox-DpWF0v5s.js";import"./DashboardResizeHandle.vue_vue_type_script_setup_true_lang-Bj9eNWfO.js";import"./DashboardSidebarToggle.vue_vue_type_script_setup_true_lang-yvinZowi.js";import"./index-88opOQSr.js";import"./useFocusGuards-CqN9EHnP.js";import"./useDirection-L6XtVArv.js";import"./useFormControl-DwrQSjJN.js";import"./useBodyScrollLock-CA2MgwBo.js";import"./Label-CHQ0EKZ9.js";import"./index-Dnaliv4H.js";import"./RovingFocusGroup-BxD9bDZV.js";import"./useArrowNavigation-B5rxJs06.js";import"./isValueEqualOrExist-Fpwey4SD.js";import"./RovingFocusItem-D4fW7EEy.js";import"./VisuallyHiddenInput-C__kJX8b.js";const Ce={class:"space-y-6"},Ue={key:1,class:"space-y-2"},Ie={key:2,class:"space-y-2"},$e={key:3,class:"space-y-2"},Ae={class:"space-y-2"},Ne={class:"flex gap-3 pt-4"},Le=H({__name:"FormSkeleton",props:{fieldCount:{default:3},showTitle:{type:Boolean,default:!0},showSelect:{type:Boolean,default:!1},showTextarea:{type:Boolean,default:!1},showCheckboxGroup:{type:Boolean,default:!1}},setup(Q){return(p,w)=>{const r=Z;return d(),m("div",Ce,[p.showTitle?(d(),C(r,{key:0,class:"h-8 w-48"})):k("",!0),(d(!0),m(D,null,E(p.fieldCount,x=>(d(),m("div",{key:`field-${x}`,class:"space-y-2"},[s(r,{class:"h-4 w-24"}),s(r,{class:"h-10 w-full",ui:{rounded:"rounded-md"}})]))),128)),p.showSelect?(d(),m("div",Ue,[s(r,{class:"h-4 w-32"}),s(r,{class:"h-10 w-full",ui:{rounded:"rounded-md"}})])):k("",!0),p.showTextarea?(d(),m("div",Ie,[s(r,{class:"h-4 w-40"}),s(r,{class:"h-24 w-full",ui:{rounded:"rounded-md"}})])):k("",!0),p.showCheckboxGroup?(d(),m("div",$e,[s(r,{class:"h-4 w-36"}),a("div",Ae,[(d(),m(D,null,E(3,x=>a("div",{key:`checkbox-${x}`,class:"flex items-center gap-2"},[s(r,{class:"h-5 w-5",ui:{rounded:"rounded"}}),s(r,{class:"h-4 w-20"})])),64))])])):k("",!0),a("div",Ne,[s(r,{class:"h-10 w-24",ui:{rounded:"rounded-md"}}),s(r,{class:"h-10 w-24",ui:{rounded:"rounded-md"}})])])}}}),Te={key:0,class:"flex items-center gap-2"},De={class:"text-sm text-boulder-600 dark:text-boulder-400"},Ee={class:"space-y-6"},Pe={class:"flex items-center justify-between"},ze={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Fe={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Be={class:"flex items-center justify-between"},qe={class:"text-sm text-boulder-500 dark:text-boulder-400"},Oe={key:1,class:"py-8 text-center text-red-600 dark:text-red-400"},Re={key:2,class:"py-12 text-center text-boulder-500 dark:text-boulder-400"},je={key:3},Ke={class:"py-12 text-center text-boulder-500 dark:text-boulder-400"},Me={class:"p-4 bg-shark-50 dark:bg-shark-800/50"},Je={class:"space-y-3"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={class:"space-y-1 text-sm"},Ze={class:"space-y-1 text-sm"},Qe={key:0,class:"w-7xl"},We={class:"text-xs bg-white dark:bg-shark-900 p-2 rounded border overflow-auto max-h-32"},Xe={class:"flex border-t border-shark-200 dark:border-shark-700 px-5 pt-3 justify-between items-center"},Ye={class:"flex"},et=H({__name:"logs",setup(Q){const p=g(!1),w=g(null),r=g({}),x=g({}),P=g([]),z=g({}),U=g([]),_=g({pageIndex:0,pageSize:25}),y=g({current_page:1,per_page:25,total:0,total_pages:0,from:1,to:1}),W=g(["25","50","100"]),I=g("25"),o=g({search:"",category:"",action:"",severity:"",from_date:"",to_date:""}),X=["authentication","data_access","user","system","security","api"],Y=["info","warning","error","critical"],F=N(()=>U.value),ee=N(()=>[{id:"select",header:({table:t})=>v(G,{modelValue:t.getIsAllPageRowsSelected(),"onUpdate:modelValue":e=>t.toggleAllPageRowsSelected(!!e),indeterminate:t.getIsSomePageRowsSelected()}),cell:({row:t})=>v(G,{modelValue:t.getIsSelected(),"onUpdate:modelValue":e=>t.toggleSelected(!!e)}),enableSorting:!1,enableHiding:!1},{id:"expand",header:"",cell:({row:t})=>v(M,{variant:"ghost",size:"sm",icon:t.getIsExpanded()?"i-heroicons-chevron-down":"i-heroicons-chevron-right",onClick:()=>t.toggleExpanded()}),enableSorting:!1,enableHiding:!1},{accessorKey:"timestamp",header:"Timestamp",cell:({row:t})=>v("span",{class:"text-xs font-mono"},oe(t.getValue("timestamp"))),enableSorting:!0},{accessorKey:"category",header:"Category",cell:({row:t})=>v("span",{class:"inline-flex"},v(T,{color:"secondary",variant:"outline"},()=>t.getValue("category"))),enableSorting:!0},{accessorKey:"action",header:"Action",enableSorting:!0},{accessorKey:"severity",header:"Severity",cell:({row:t})=>v("span",{class:"inline-flex"},v(T,{color:te(t.getValue("severity")),variant:"subtle"},()=>t.getValue("severity"))),enableSorting:!0},{accessorKey:"ip_address",header:"IP Address",cell:({row:t})=>v("span",{class:"text-xs font-mono"},t.getValue("ip_address")),enableSorting:!0},{accessorKey:"request_method",header:"Method",cell:({row:t})=>v("span",{class:"inline-flex"},v(T,{color:ae(t.getValue("request_method")),variant:"subtle"},()=>t.getValue("request_method"))),enableSorting:!0},{accessorKey:"request_uri",header:"URI",cell:({row:t})=>v("div",{class:"max-w-xs truncate",title:t.getValue("request_uri")},t.getValue("request_uri")),enableSorting:!0}]),te=t=>{switch(t==null?void 0:t.toLowerCase()){case"info":return"info";case"warning":return"warning";case"error":return"error";case"critical":return"error";default:return"neutral"}},ae=t=>{switch(t==null?void 0:t.toUpperCase()){case"GET":return"success";case"POST":return"info";case"PUT":return"warning";case"PATCH":return"warning";case"DELETE":return"error";default:return"neutral"}},oe=t=>new Date(t).toLocaleString();async function h(t=1){p.value=!0,w.value=null;try{const e={page:t,per_page:_.value.pageSize,...o.value.search&&{search:o.value.search},...o.value.from_date&&{from_date:o.value.from_date},...o.value.to_date&&{to_date:o.value.to_date},...o.value.category&&{category:o.value.category},...o.value.action&&{action:o.value.action},...o.value.severity&&{severity:o.value.severity}},i=await L.logs.getAuditLogs(e);if(i.success&&i.data){U.value=i.data||[];const c={current_page:i.current_page||1,per_page:i.per_page||50,total:i.total||0,total_pages:i.last_page||0};y.value={...c,from:(c.current_page-1)*c.per_page+1,to:Math.min(c.current_page*c.per_page,c.total)},_.value.pageIndex=c.current_page-1}}catch(e){const i=e;w.value=i.message||"Failed to fetch logs"}finally{p.value=!1}}function se(){o.value={search:"",category:"",action:"",severity:"",from_date:"",to_date:""},_.value.pageIndex=0,h(1)}const B=N(()=>Object.keys(r.value).length);function le(){return Object.keys(r.value).filter(t=>r.value[t])}async function q(t){var i;if(le().length!==0)try{const c={type:"audit",format:t,...o.value.from_date&&{from_date:o.value.from_date},...o.value.to_date&&{to_date:o.value.to_date},...o.value.category&&{category:o.value.category}},S=await L.logs.exportLogs(c);(i=S.data)!=null&&i.download_url&&window.open(S.data.download_url,"_blank")}catch{}}function ne(){r.value={}}async function O(t){var e;try{const i={type:"audit",format:t,...o.value.from_date&&{from_date:o.value.from_date},...o.value.to_date&&{to_date:o.value.to_date},...o.value.category&&{category:o.value.category},...o.value.severity&&{level:o.value.severity}},c=await L.logs.exportLogs(i);(e=c.data)!=null&&e.download_url&&window.open(c.data.download_url,"_blank")}catch{}}function re(t){console.log("Changing page to:",t),_.value.pageIndex=t-1,h(t)}return J(o,()=>{_.value.pageIndex=0,h(1)},{deep:!0}),J(()=>I.value,t=>{_.value.pageSize=Number(t),_.value.pageIndex=0,h(1)}),_e(()=>{h(1)}),(t,e)=>{const i=M,c=Ve,S=Se,R=Z,ie=Le,V=we,b=ke,$=be,j=he,de=xe,A=ye,ue=ve,ce=ge,me=pe;return d(),C(me,{id:"logs"},{header:n(()=>[s(S,{title:"Audit Logs"},{right:n(()=>[B.value>0?(d(),m("div",Te,[a("span",De,u(B.value)+" selected",1),s(c,{items:[[{label:"Export Selected as CSV",icon:"i-heroicons-document-arrow-down",onClick:()=>q("csv")},{label:"Export Selected as JSON",icon:"i-heroicons-document-arrow-down",onClick:()=>q("json")}],[{label:"Clear Selection",icon:"i-heroicons-x-mark",onClick:ne}]]},{default:n(()=>[s(i,{variant:"outline",icon:"i-heroicons-ellipsis-horizontal",size:"sm"},{default:n(()=>e[13]||(e[13]=[f(" Actions ")])),_:1,__:[13]})]),_:1},8,["items"])])):k("",!0),s(c,{items:[[{label:"Export as CSV",icon:"i-heroicons-document-arrow-down",onClick:()=>O("csv")},{label:"Export as JSON",icon:"i-heroicons-document-arrow-down",onClick:()=>O("json")}]]},{default:n(()=>[s(i,{variant:"outline",icon:"i-heroicons-arrow-down-tray",size:"sm"},{default:n(()=>e[14]||(e[14]=[f(" Export ")])),_:1,__:[14]})]),_:1},8,["items"]),s(i,{variant:"ghost",icon:"i-heroicons-arrow-path",loading:p.value,onClick:e[0]||(e[0]=l=>h(y.value.current_page)),size:"sm"},null,8,["loading"])]),_:1})]),body:n(()=>[a("div",Ee,[s(j,null,{header:n(()=>[a("div",Pe,[e[16]||(e[16]=a("h3",{class:"text-lg font-medium"},"Filters",-1)),s(i,{variant:"ghost",size:"sm",onClick:se},{default:n(()=>e[15]||(e[15]=[f(" Clear All ")])),_:1,__:[15]})])]),default:n(()=>[p.value&&U.value.length===0?(d(),C(ie,{key:0,"field-count":0,"show-title":!1},{default:n(()=>[a("div",ze,[(d(),m(D,null,E(6,l=>a("div",{key:`filter-skeleton-${l}`,class:"space-y-2"},[s(R,{class:"h-4 w-24"}),s(R,{class:"h-10 w-full",ui:{rounded:"rounded-md"}})])),64))])]),_:1})):(d(),m("div",Fe,[s(b,{label:"Search",name:"search"},{default:n(()=>[s(V,{modelValue:o.value.search,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.search=l),placeholder:"Search logs...",icon:"i-heroicons-magnifying-glass"},null,8,["modelValue"])]),_:1}),s(b,{label:"From Date",name:"from_date"},{default:n(()=>[s(V,{modelValue:o.value.from_date,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.from_date=l),type:"datetime-local"},null,8,["modelValue"])]),_:1}),s(b,{label:"To Date",name:"to_date"},{default:n(()=>[s(V,{modelValue:o.value.to_date,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.to_date=l),type:"datetime-local"},null,8,["modelValue"])]),_:1}),s(b,{label:"Category",name:"category"},{default:n(()=>[s($,{modelValue:o.value.category,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.category=l),placeholder:"All Categories",items:X},null,8,["modelValue"])]),_:1}),s(b,{label:"Severity",name:"severity"},{default:n(()=>[s($,{modelValue:o.value.severity,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.severity=l),placeholder:"All Severities",items:Y},null,8,["modelValue"])]),_:1}),s(b,{label:"Action",name:"action"},{default:n(()=>[s(V,{modelValue:o.value.action,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.action=l),placeholder:"Filter by action..."},null,8,["modelValue"])]),_:1})]))]),_:1}),s(j,null,fe({header:n(()=>[a("div",Be,[e[17]||(e[17]=a("h3",{class:"text-lg font-medium"},"Audit Logs",-1)),a("div",qe,u(y.value.total)+" total entries",1)])]),default:n(()=>[p.value?(d(),C(de,{key:0,"row-count":10,"column-count":9})):w.value?(d(),m("div",Oe,[s(A,{name:"i-heroicons-exclamation-triangle",class:"text-2xl mb-2"}),a("p",null,u(w.value),1)])):F.value.length===0?(d(),m("div",Re,[s(A,{name:"i-heroicons-document-text",class:"text-4xl mb-2"}),e[18]||(e[18]=a("p",null,"No logs found",-1))])):(d(),m("div",je,[s(ue,{"row-selection":r.value,"onUpdate:rowSelection":e[7]||(e[7]=l=>r.value=l),expanded:x.value,"onUpdate:expanded":e[8]||(e[8]=l=>x.value=l),sorting:P.value,"onUpdate:sorting":e[9]||(e[9]=l=>P.value=l),"column-visibility":z.value,"onUpdate:columnVisibility":e[10]||(e[10]=l=>z.value=l),columns:ee.value,data:F.value,loading:p.value,sticky:"",class:"w-full",ui:{th:"px-4 py-3.5 text-sm text-highlighted text-left rtl:text-right font-semibold whitespace-nowrap"}},{empty:n(()=>[a("div",Ke,[s(A,{name:"i-heroicons-document-text",class:"text-4xl mb-2"}),e[19]||(e[19]=a("p",null,"No logs found",-1))])]),expanded:n(({row:l})=>[a("div",Me,[a("div",Je,[a("div",Ge,[a("div",null,[e[24]||(e[24]=a("h4",{class:"font-medium text-sm text-shark-900 dark:text-shark-100 mb-2"}," Request Details ",-1)),a("div",He,[a("div",null,[e[20]||(e[20]=a("span",{class:"font-medium"},"Method:",-1)),f(" "+u(l.original.request_method),1)]),a("div",null,[e[21]||(e[21]=a("span",{class:"font-medium"},"URI:",-1)),f(" "+u(l.original.request_uri),1)]),a("div",null,[e[22]||(e[22]=a("span",{class:"font-medium"},"IP:",-1)),f(" "+u(l.original.ip_address),1)]),a("div",null,[e[23]||(e[23]=a("span",{class:"font-medium"},"User Agent:",-1)),f(" "+u(l.original.user_agent||"N/A"),1)])])]),a("div",null,[e[29]||(e[29]=a("h4",{class:"font-medium text-sm text-shark-900 dark:text-shark-100 mb-2"}," Event Details ",-1)),a("div",Ze,[a("div",null,[e[25]||(e[25]=a("span",{class:"font-medium"},"Event ID:",-1)),f(" "+u(l.original.event_id),1)]),a("div",null,[e[26]||(e[26]=a("span",{class:"font-medium"},"Actor ID:",-1)),f(" "+u(l.original.actor_id||"N/A"),1)]),a("div",null,[e[27]||(e[27]=a("span",{class:"font-medium"},"Target:",-1)),f(" "+u(l.original.target_type)+" ("+u(l.original.target_id||"N/A")+") ",1)]),a("div",null,[e[28]||(e[28]=a("span",{class:"font-medium"},"Session ID:",-1)),f(" "+u(l.original.session_id||"N/A"),1)])])])]),l.original.details?(d(),m("div",Qe,[e[30]||(e[30]=a("h4",{class:"font-medium text-sm text-shark-900 dark:text-shark-100 mb-2"}," Additional Details ",-1)),a("pre",We,u(JSON.stringify(JSON.parse(l.original.details||"{}"),null,2)),1)])):k("",!0)])])]),_:1},8,["row-selection","expanded","sorting","column-visibility","columns","data","loading"])]))]),_:2},[y.value.total_pages>1?{name:"footer",fn:n(()=>[a("div",Xe,[a("div",null,u(y.value.from)+" to "+u(y.value.to)+" of "+u(y.value.total),1),a("div",Ye,[s(ce,{"default-page":_.value.pageIndex+1,page:_.value.pageIndex+1,"items-per-page":Number(_.value.pageSize),total:y.value.total,"onUpdate:page":e[11]||(e[11]=l=>{_.value.pageIndex=l-1,re(l)}),class:"mr-3"},null,8,["default-page","page","items-per-page","total"]),s($,{modelValue:I.value,"onUpdate:modelValue":e[12]||(e[12]=l=>I.value=l),items:W.value,class:"w-20"},null,8,["modelValue","items"])])])]),key:"0"}:void 0]),1024)])]),_:1})}}});typeof K=="function"&&K(et);export{et as default};
