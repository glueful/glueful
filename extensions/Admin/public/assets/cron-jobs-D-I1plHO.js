import{_ as ee,b as B}from"./route-block-C8UpW1tJ.js";import{_ as F}from"./Badge-UswX4ZtY.js";import{_ as te}from"./Table-DfRn1MFI.js";import{_ as se}from"./TableDataSkeleton.vue_vue_type_script_setup_true_lang-C_75FIk9.js";import{_ as oe}from"./Card-3ffy2SwE.js";import{d as ne,r as m,f as v,A as ae,i as C,o as i,j as n,Z as t,k as o,z as E,B as x,F as R,ai as I,O as r,am as le,av as g,ah as re,N as p,at as N}from"./index-CvplhhIg.js";import{_ as ie}from"./CardSkeleton.vue_vue_type_script_setup_true_lang-bZ34LqmC.js";import{_ as ue}from"./DashboardNavbar.vue_vue_type_script_setup_true_lang-DXiLQDGX.js";import{_ as K}from"./Checkbox-DpWF0v5s.js";import{u as ce}from"./useToastNotification-D4GVV2D1.js";import"./DashboardResizeHandle.vue_vue_type_script_setup_true_lang-Bj9eNWfO.js";import"./DashboardSidebarToggle.vue_vue_type_script_setup_true_lang-yvinZowi.js";import"./index-88opOQSr.js";import"./Skeleton-BW74k3wi.js";import"./useDirection-L6XtVArv.js";import"./isValueEqualOrExist-Fpwey4SD.js";import"./useFormControl-DwrQSjJN.js";import"./RovingFocusItem-D4fW7EEy.js";import"./RovingFocusGroup-BxD9bDZV.js";import"./VisuallyHiddenInput-C__kJX8b.js";import"./Label-CHQ0EKZ9.js";const de={key:0,class:"flex items-center gap-2"},me={class:"text-sm text-boulder-600 dark:text-boulder-400"},xe={class:"space-y-6"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},be={class:"flex items-center justify-between"},_e={class:"text-2xl font-bold text-shark-900 dark:text-shark-100"},ve={class:"flex items-center justify-between"},ge={class:"text-2xl font-bold text-green-600 dark:text-green-400"},pe={class:"flex items-center justify-between"},he={class:"text-2xl font-bold text-boulder-600 dark:text-boulder-400"},ye={class:"flex items-center justify-between"},ke={class:"text-2xl font-bold text-orange-600 dark:text-orange-400"},we={class:"flex items-center justify-between"},Je={class:"text-sm text-boulder-500 dark:text-boulder-400"},Ce={key:1,class:"py-8 text-center text-red-600 dark:text-red-400"},Se={key:2,class:"py-12 text-center text-boulder-500 dark:text-boulder-400"},De={key:3},Re={class:"py-12 text-center text-boulder-500 dark:text-boulder-400"},Ne={class:"flex items-center justify-between"},je={class:"space-y-2"},Ve={class:"flex items-center gap-3"},$e={class:"font-medium text-sm"},Ae={class:"text-xs text-boulder-600 dark:text-boulder-400 font-mono"},Ue={class:"text-xs text-boulder-500 dark:text-boulder-400"},Te={class:"flex items-center gap-2"},ze={class:"flex items-center justify-between"},Be={class:"text-center py-8"},Fe={class:"text-boulder-600 dark:text-boulder-400"},Ee=ne({__name:"cron-jobs",setup(Ie){const f=m(!1),S=m(!1),y=m(!1),k=m(null),u=m([]),b=ce(),w=m({}),j=m([]),V=m({}),P=v(()=>u.value.filter(s=>s.status==="active"||s.status==="enabled")),L=v(()=>u.value.filter(s=>s.status==="inactive"||s.status==="disabled")),$=v(()=>{const s=new Date;return u.value.filter(e=>e.next_run?new Date(e.next_run)<=s&&(e.status==="active"||e.status==="enabled"):!1)}),O=v(()=>P.value.length),H=v(()=>L.value.length),h=v(()=>$.value.length),M=[{id:"select",header:({table:s})=>g(K,{modelValue:s.getIsAllPageRowsSelected(),"onUpdate:modelValue":e=>s.toggleAllPageRowsSelected(!!e),indeterminate:s.getIsSomePageRowsSelected()}),cell:({row:s})=>g(K,{modelValue:s.getIsSelected(),"onUpdate:modelValue":e=>s.toggleSelected(!!e)}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Job Name",cell:({row:s})=>{const e=s.getValue("name");return g("div",{class:"font-medium text-sm",title:e},e)},enableSorting:!0},{accessorKey:"status",header:"Status",cell:({row:s})=>{const e=s.getValue("status"),a=e==="active"||e==="enabled";return g(F,{color:a?"green":"gray",variant:"subtle"},()=>a?"Active":"Inactive")},enableSorting:!0},{accessorKey:"command",header:"Command",cell:({row:s})=>{const e=s.getValue("command");return g("div",{class:"max-w-xs truncate text-xs text-boulder-600 dark:text-boulder-400 font-mono",title:e},e)},enableSorting:!1},{accessorKey:"next_run",header:"Next Run",cell:({row:s})=>{const e=s.getValue("next_run");return e?g("span",{class:"text-xs font-mono"},D(e)):"â€”"},enableSorting:!0},{accessorKey:"last_run",header:"Last Run",cell:({row:s})=>{const e=s.getValue("last_run");return e?g("span",{class:"text-xs font-mono"},D(e)):"Never"},enableSorting:!0},{id:"action"}],D=s=>new Date(s).toLocaleString();async function J(){var s;f.value=!0,k.value=null;try{const e=await N.jobs.getAllJobs();if(e.success){const a=Array.isArray(e.data)?e.data:((s=e.data)==null?void 0:s.jobs)||[];u.value=a.map(d=>({id:d.id,name:d.name,command:d.command,next_run:d.next_run,last_run:d.last_run,status:d.status}))}}catch(e){const a=e;k.value=a.message||"Failed to fetch jobs",b.error({title:"Error",description:k.value})}finally{f.value=!1}}async function A(s){S.value=!0;try{const e=await N.jobs.runJob(s);e.success&&(b.success({title:"Job Executed",description:e.data.message||`Job ${s} executed successfully.`}),await J())}catch(e){const a=e;b.error({title:"Job Execution Failed",description:a.message||"Failed to run job"})}finally{S.value=!1}}async function U(){if(h.value===0){b.warn({title:"No Due Jobs",description:"There are no jobs currently due for execution."});return}y.value=!0;try{const s=await N.jobs.runDueJobs();if(s.success){const e=s.data.executed||0;b.success({title:"Jobs Executed",description:`Successfully executed ${e} job(s).`}),await J()}}catch(s){const e=s;b.error({title:"Job Execution Failed",description:e.message||"Failed to run due jobs"})}finally{y.value=!1}}async function Z(){await J(),b.success({title:"Refreshed",description:"Job status updated."})}function q(){w.value={}}const T=v(()=>Object.keys(w.value).length);return ae(()=>{J()}),(s,e)=>{const a=re,d=ue,G=ie,c=le,_=oe,Q=se,W=te,z=F,X=ee;return i(),C(X,{id:"cron-jobs"},{header:n(()=>[o(d,{title:"Cron Jobs"},{right:n(()=>[T.value>0?(i(),x("div",de,[t("span",me,r(T.value)+" selected",1),o(a,{variant:"ghost",size:"sm",icon:"i-heroicons-x-mark",onClick:q},{default:n(()=>e[3]||(e[3]=[p(" Clear ")])),_:1,__:[3]})])):E("",!0),o(a,{color:"primary",size:"sm",icon:"i-heroicons-play",loading:y.value,disabled:h.value===0||y.value,onClick:U},{default:n(()=>[p(" Run Due Jobs ("+r(h.value)+") ",1)]),_:1},8,["loading","disabled"]),o(a,{variant:"ghost",icon:"i-heroicons-arrow-path",loading:f.value,onClick:Z,size:"sm"},null,8,["loading"])]),_:1})]),body:n(()=>[t("div",xe,[t("div",fe,[f.value?(i(),x(R,{key:0},I(4,l=>o(G,{key:`card-skeleton-${l}`,"show-header":!1,"show-image":!1,"line-count":0,"show-title":!1})),64)):(i(),x(R,{key:1},[o(_,null,{default:n(()=>[t("div",be,[t("div",null,[e[4]||(e[4]=t("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Total Jobs",-1)),t("p",_e,r(u.value.length),1)]),o(c,{name:"i-heroicons-clock",class:"h-8 w-8 text-blue-500"})])]),_:1}),o(_,null,{default:n(()=>[t("div",ve,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Active",-1)),t("p",ge,r(O.value),1)]),o(c,{name:"i-heroicons-check-circle",class:"h-8 w-8 text-green-500"})])]),_:1}),o(_,null,{default:n(()=>[t("div",pe,[t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Inactive",-1)),t("p",he,r(H.value),1)]),o(c,{name:"i-heroicons-pause-circle",class:"h-8 w-8 text-boulder-500 dark:text-boulder-400"})])]),_:1}),o(_,null,{default:n(()=>[t("div",ye,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Due Now",-1)),t("p",ke,r(h.value),1)]),o(c,{name:"i-heroicons-exclamation-triangle",class:"h-8 w-8 text-orange-500"})])]),_:1})],64))]),o(_,null,{header:n(()=>[t("div",we,[e[8]||(e[8]=t("h3",{class:"text-lg font-medium"},"All Jobs",-1)),t("div",Je,r(u.value.length)+" total jobs",1)])]),default:n(()=>[f.value?(i(),C(Q,{key:0,"row-count":8,"column-count":7})):k.value?(i(),x("div",Ce,[o(c,{name:"i-heroicons-exclamation-triangle",class:"text-2xl mb-2"}),t("p",null,r(k.value),1)])):u.value.length===0?(i(),x("div",Se,[o(c,{name:"i-heroicons-clock",class:"text-4xl mb-2"}),e[9]||(e[9]=t("p",null,"No jobs found",-1))])):(i(),x("div",De,[o(W,{"row-selection":w.value,"onUpdate:rowSelection":e[0]||(e[0]=l=>w.value=l),sorting:j.value,"onUpdate:sorting":e[1]||(e[1]=l=>j.value=l),"column-visibility":V.value,"onUpdate:columnVisibility":e[2]||(e[2]=l=>V.value=l),columns:M,data:u.value,loading:f.value,sticky:"",class:"w-full",ui:{th:"px-4 py-3.5 text-sm text-highlighted text-left rtl:text-right font-semibold whitespace-nowrap"}},{"action-cell":n(({row:l})=>[o(a,{variant:"ghost",size:"sm",icon:"i-heroicons-play",onClick:Y=>A(l.original.name)},{default:n(()=>e[10]||(e[10]=[p(" Run ")])),_:2,__:[10]},1032,["onClick"])]),empty:n(()=>[t("div",Re,[o(c,{name:"i-heroicons-clock",class:"text-4xl mb-2"}),e[11]||(e[11]=t("p",null,"No jobs found",-1))])]),_:1},8,["row-selection","sorting","column-visibility","data","loading"])]))]),_:1}),h.value>0?(i(),C(_,{key:0},{header:n(()=>[t("div",Ne,[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-orange-600 dark:text-orange-400"},"Jobs Due Now",-1)),o(z,{color:"warning",variant:"subtle"},{default:n(()=>[p(r(h.value)+" due",1)]),_:1})])]),footer:n(()=>[t("div",ze,[e[16]||(e[16]=t("p",{class:"text-sm text-boulder-600 dark:text-boulder-400"}," These jobs are currently due for execution. ",-1)),o(a,{color:"warning",variant:"outline",size:"sm",icon:"i-heroicons-play",loading:y.value,onClick:U},{default:n(()=>e[15]||(e[15]=[p(" Run All Due ")])),_:1,__:[15]},8,["loading"])])]),default:n(()=>[t("div",je,[(i(!0),x(R,null,I($.value,l=>(i(),x("div",{key:l.id,class:"flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800"},[t("div",Ve,[o(c,{name:"i-heroicons-exclamation-triangle",class:"text-orange-500"}),t("div",null,[t("p",$e,r(l.name),1),t("p",Ae,r(l.command),1),t("p",Ue,"Due: "+r(D(l.next_run)),1)])]),t("div",Te,[o(z,{color:"warning",variant:"subtle"},{default:n(()=>e[13]||(e[13]=[p("Due")])),_:1,__:[13]}),o(a,{variant:"outline",size:"sm",icon:"i-heroicons-play",loading:S.value,onClick:Y=>A(l.name)},{default:n(()=>e[14]||(e[14]=[p(" Run ")])),_:2,__:[14]},1032,["loading","onClick"])])]))),128))])]),_:1})):u.value.length>0&&!f.value?(i(),C(_,{key:1},{default:n(()=>[t("div",Be,[o(c,{name:"i-heroicons-check-circle",class:"text-6xl text-green-500 mb-4"}),e[17]||(e[17]=t("h3",{class:"text-lg font-medium text-green-600 dark:text-green-400 mb-2"}," All Jobs Up to Date ",-1)),t("p",Fe," No jobs are currently due for execution. "+r(u.value.length)+" jobs are scheduled. ",1)])]),_:1})):E("",!0)])]),_:1})}}});typeof B=="function"&&B(Ee);export{Ee as default};
