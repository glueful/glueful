import{_ as Re,b as he}from"./route-block-C8UpW1tJ.js";import{_ as Ce}from"./Tabs-C56t79Fw.js";import{_ as Ve}from"./Card-3ffy2SwE.js";import{d as ie,r as g,E as oe,f as O,av as f,ah as Q,B as h,o as _,Z as a,k as t,i as le,j as l,N as S,am as ue,O as A,z as J,F as se,at as G,ai as ge,A as $e}from"./index-CvplhhIg.js";import{_ as Pe}from"./CardSkeleton.vue_vue_type_script_setup_true_lang-bZ34LqmC.js";import{_ as ze}from"./DashboardNavbar.vue_vue_type_script_setup_true_lang-DXiLQDGX.js";import{u as de}from"./useToastNotification-D4GVV2D1.js";import{_ as ve}from"./Modal-9avKWxcn.js";import{_ as we}from"./Textarea-CrA6wPU_.js";import{_ as fe}from"./FormField-VDwBeIdM.js";import{_ as _e}from"./Input-C5IL3dmi.js";import{_ as ye}from"./Select-BAUrMTbe.js";import{_ as xe}from"./Pagination-CIUYPgU7.js";import{_ as be}from"./Table-DfRn1MFI.js";import{_ as Ue}from"./TableDataSkeleton.vue_vue_type_script_setup_true_lang-C_75FIk9.js";import{_ as te}from"./Badge-UswX4ZtY.js";import{_ as re}from"./Checkbox-DpWF0v5s.js";import{_ as Ie}from"./Skeleton-BW74k3wi.js";import{_ as De}from"./DropdownMenu-DWboWW_y.js";import"./DashboardResizeHandle.vue_vue_type_script_setup_true_lang-Bj9eNWfO.js";import"./DashboardSidebarToggle.vue_vue_type_script_setup_true_lang-yvinZowi.js";import"./TabsTrigger-CfrKEHQY.js";import"./RovingFocusGroup-BxD9bDZV.js";import"./useDirection-L6XtVArv.js";import"./RovingFocusItem-D4fW7EEy.js";import"./DialogPortal-BWtgM8-G.js";import"./useBodyScrollLock-CA2MgwBo.js";import"./Label-CHQ0EKZ9.js";import"./useFocusGuards-CqN9EHnP.js";import"./useFormControl-DwrQSjJN.js";import"./index-88opOQSr.js";import"./isValueEqualOrExist-Fpwey4SD.js";import"./VisuallyHiddenInput-C__kJX8b.js";import"./index-Dnaliv4H.js";import"./useArrowNavigation-B5rxJs06.js";const Ae={class:"p-6"},Fe={class:"flex justify-between items-center mb-4"},Ne={key:1,class:"py-8 text-center text-red-600 dark:text-red-400"},Te={key:2,class:"py-12 text-center text-gray-500"},je={key:3},Ee={class:"py-12 text-center text-gray-500"},Me={key:0,class:"mt-6 flex border-t border-gray-200 dark:border-gray-700 px-5 pt-3 justify-between items-center"},qe={class:"flex"},Be={class:"space-y-4"},Ke={class:"flex justify-end gap-2"},Le=ie({__name:"PermissionsTab",props:{permissions:{default:()=>[]},pagination:{default:()=>({current_page:1,per_page:25,total:0,last_page:1})},loading:{type:Boolean,default:!1},error:{default:null}},emits:["editPermission","deletePermission","permissionCreated","refresh-data","update:page-size","update:page","on-delete"],setup(ae,{emit:M}){const $=ae,p=g({}),z=g({pageIndex:0,pageSize:25}),R=g(["25","50","100"]),P=g("25"),F=g(!1),C=g({name:"",description:"",slug:""}),I=de(),b=M;async function x(){if(!C.value.name.trim()){I.warn({title:"Validation Error",description:"Permission name is required"});return}try{(await G.permissions.createPermission(C.value)).success&&(I.success({title:"Permission Created",description:`Permission "${C.value.name}" created successfully.`}),F.value=!1,C.value={name:"",description:"",slug:""},b("refresh-data"))}catch(m){const r=m;I.error({title:"Error",description:r.message||"Failed to create permission"})}}oe(()=>$.pagination,m=>{m&&(z.value.pageIndex=m.current_page-1,z.value.pageSize=m.per_page,P.value=String(m.per_page))},{immediate:!0}),oe(()=>P.value,m=>{z.value.pageSize=Number(m),z.value.pageIndex=0,b("update:page-size",m)});const v=O(()=>{var B,K,H;const m=((B=$.pagination)==null?void 0:B.total)||$.permissions.length,r=((K=$.pagination)==null?void 0:K.current_page)||1,D=((H=$.pagination)==null?void 0:H.per_page)||25,N=m>0?(r-1)*D+1:0,q=Math.min(r*D,m);return{from:N,to:q,total:m}}),U=O(()=>[{accessorKey:"name",header:"Permission Name",cell:({row:m})=>{const r=m.getValue("name");return f("div",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},r)},enableSorting:!0},{accessorKey:"slug",header:"Slug",cell:({row:m})=>{const r=m.getValue("slug");return f("div",{class:"text-sm font-mono text-gray-600 dark:text-gray-400"},r)},enableSorting:!0},{accessorKey:"category",header:"Category",cell:({row:m})=>{const r=m.getValue("category");return f(te,{variant:"subtle",color:{content:"blue",roles:"green",users:"purple",system:"red"}[r]||"gray"},()=>r.charAt(0).toUpperCase()+r.slice(1))},enableSorting:!0},{accessorKey:"description",header:"Description",cell:({row:m})=>{const r=m.getValue("description");return f("div",{class:"text-sm text-gray-600 dark:text-gray-400 max-w-xs truncate"},r)},enableSorting:!1},{id:"actions",header:"Actions",cell:({row:m})=>{const r=m.original;return f("div",{class:"flex gap-2"},[f(Q,{variant:"ghost",size:"sm",icon:"i-heroicons-pencil",onClick:()=>b("editPermission",r)}),f(Q,{variant:"ghost",size:"sm",icon:"i-heroicons-trash",color:"red",onClick:()=>b("deletePermission",r.uuid)})])},enableSorting:!1}]);return(m,r)=>{const D=Q,N=Ue,q=ue,B=be,K=xe,H=ye,d=_e,s=fe,V=we,W=ve;return _(),h(se,null,[a("div",Ae,[a("div",Fe,[r[9]||(r[9]=a("h3",{class:"text-lg font-semibold"},"Permissions",-1)),t(D,{color:"primary",size:"sm",icon:"i-heroicons-plus",onClick:r[0]||(r[0]=w=>F.value=!0)},{default:l(()=>r[8]||(r[8]=[S(" New Permission ")])),_:1,__:[8]})]),$.loading?(_(),le(N,{key:0,"row-count":8,"column-count":5})):$.error?(_(),h("div",Ne,[t(q,{name:"i-heroicons-exclamation-triangle",class:"text-2xl mb-2"}),a("p",null,A($.error),1)])):$.permissions.length===0?(_(),h("div",Te,[t(q,{name:"i-heroicons-key",class:"text-4xl mb-2"}),r[10]||(r[10]=a("p",null,"No permissions found",-1))])):(_(),h("div",je,[t(B,{"row-selection":p.value,"onUpdate:rowSelection":r[1]||(r[1]=w=>p.value=w),columns:U.value,data:$.permissions,loading:$.loading,class:"w-full"},{empty:l(()=>[a("div",Ee,[t(q,{name:"i-heroicons-key",class:"text-4xl mb-2"}),r[11]||(r[11]=a("p",null,"No permissions found",-1))])]),_:1},8,["row-selection","columns","data","loading"]),$.permissions.length>0?(_(),h("div",Me,[a("div",null,A(v.value.from)+" to "+A(v.value.to)+" of "+A(v.value.total),1),a("div",qe,[t(K,{"default-page":z.value.pageIndex+1,page:z.value.pageIndex+1,"items-per-page":Number(z.value.pageSize),total:v.value.total,"onUpdate:page":r[2]||(r[2]=w=>{z.value.pageIndex=w-1,b("update:page",z.value)}),class:"mr-3"},null,8,["default-page","page","items-per-page","total"]),t(H,{modelValue:P.value,"onUpdate:modelValue":r[3]||(r[3]=w=>P.value=w),items:R.value,class:"w-20"},null,8,["modelValue","items"])])])):J("",!0)]))]),t(W,{open:F.value,"onUpdate:open":r[7]||(r[7]=w=>F.value=w),title:"Create New Permission"},{body:l(()=>[a("div",Be,[t(s,{label:"Permission Name",required:""},{default:l(()=>[t(d,{modelValue:C.value.name,"onUpdate:modelValue":r[4]||(r[4]=w=>C.value.name=w),placeholder:"e.g. users.view, posts.create",class:"w-full"},null,8,["modelValue"])]),_:1}),t(s,{label:"Description"},{default:l(()=>[t(V,{modelValue:C.value.description,"onUpdate:modelValue":r[5]||(r[5]=w=>C.value.description=w),placeholder:"Describe what this permission allows",class:"w-full",rows:3},null,8,["modelValue"])]),_:1})])]),footer:l(()=>[a("div",Ke,[t(D,{variant:"ghost",onClick:r[6]||(r[6]=w=>F.value=!1)},{default:l(()=>r[12]||(r[12]=[S(" Cancel ")])),_:1,__:[12]}),t(D,{color:"primary",onClick:x},{default:l(()=>r[13]||(r[13]=[S(" Create Permission ")])),_:1,__:[13]})])]),_:1},8,["open"])],64)}}}),Oe={class:"p-6"},Ge={class:"flex justify-between items-center mb-4"},He={key:1,class:"py-8 text-center text-red-600 dark:text-red-400"},Ze={key:2,class:"py-12 text-center text-gray-500"},Je={key:3},Qe={key:0,class:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},We={class:"flex items-center justify-between"},Xe={class:"text-sm font-medium text-blue-700 dark:text-blue-300"},Ye={class:"flex gap-2"},et={class:"py-8 text-center"},tt={class:"py-12 text-center text-gray-500"},st={key:1,class:"mt-6 flex border-t border-gray-200 dark:border-gray-700 px-5 pt-3 justify-between items-center"},at={class:"flex"},lt={class:"space-y-4"},ot={class:"flex justify-end gap-2"},nt={key:0,class:"space-y-4"},rt={class:"flex justify-end gap-2"},it=ie({__name:"RolesTab",props:{roles:{default:()=>[]},pagination:{default:()=>({current_page:1,per_page:25,total:0,last_page:1})},loading:{type:Boolean,default:!1},error:{default:null}},emits:["manageRoleUsers","roleCreated","refresh-data","update:page-size","update:page","on-delete"],setup(ae,{expose:M,emit:$}){const p=ae,z=g({}),R=g({pageIndex:0,pageSize:25}),P=g(["25","50","100"]),F=g("25"),C=g(!1),I=g(!1),b=g({name:"",slug:"",description:"",status:"active",parent_uuid:void 0}),x=g(null),v=de(),U=$;async function m(){if(!b.value.name.trim()){v.warn({title:"Validation Error",description:"Role name is required"});return}try{(await G.roles.createRole(b.value)).success&&(v.success({title:"Role Created",description:`Role "${b.value.name}" created successfully.`}),C.value=!1,b.value={name:"",slug:"",description:"",status:"active",parent_uuid:void 0},U("refresh-data"))}catch(d){const s=d;v.error({title:"Error",description:s.message||"Failed to create role"})}}function r(d){x.value={...d},I.value=!0}async function D(){if(x.value)try{(await G.roles.updateRole(x.value.uuid,{name:x.value.name,description:x.value.description,status:x.value.status})).success&&(v.success({title:"Role Updated",description:`Role "${x.value.name}" updated successfully.`}),I.value=!1,x.value=null,U("refresh-data"))}catch(d){const s=d;v.error({title:"Error",description:s.message||"Failed to update role"})}}async function N(d){if(d.name==="superuser"){v.warn({title:"Cannot Delete",description:"The superuser role cannot be deleted."});return}try{(await G.roles.deleteRole(d.uuid)).success&&(v.success({title:"Role Deleted",description:`Role "${d.name}" deleted successfully.`}),U("refresh-data"))}catch(s){const V=s;v.error({title:"Error",description:V.message||"Failed to delete role"})}}function q(d){U("manageRoleUsers",d)}oe(()=>p.pagination,d=>{d&&(R.value.pageIndex=d.current_page-1,R.value.pageSize=d.per_page,F.value=String(d.per_page))},{immediate:!0}),oe(()=>F.value,d=>{R.value.pageSize=Number(d),R.value.pageIndex=0,U("update:page-size",d)});const B=O(()=>Object.keys(z.value).length),K=O(()=>{var Y,X,T;const d=((Y=p.pagination)==null?void 0:Y.total)||p.roles.length,s=((X=p.pagination)==null?void 0:X.current_page)||1,V=((T=p.pagination)==null?void 0:T.per_page)||25,W=d>0?(s-1)*V+1:0,w=Math.min(s*V,d);return{from:W,to:w,total:d}});M({refresh:()=>U("refresh-data")});const H=O(()=>[{id:"select",header:({table:d})=>f(re,{modelValue:d.getIsAllPageRowsSelected(),"onUpdate:modelValue":s=>d.toggleAllPageRowsSelected(!!s),indeterminate:d.getIsSomePageRowsSelected()}),cell:({row:d})=>f(re,{modelValue:d.getIsSelected(),"onUpdate:modelValue":s=>d.toggleSelected(!!s),disabled:d.original.name==="superuser"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Role Name",cell:({row:d})=>{const s=d.getValue("name"),V=s==="superuser";return f("div",{class:"flex items-center gap-2"},[f("span",{class:"font-medium text-sm"},s),V?f(te,{color:"red",variant:"subtle"},()=>"Admin"):null])},enableSorting:!0},{accessorKey:"description",header:"Description",cell:({row:d})=>{const s=d.getValue("description");return f("div",{class:"text-sm text-gray-600"},s||"-")},enableSorting:!1},{accessorKey:"status",header:"Status",cell:({row:d})=>{const s=d.getValue("status");return f(te,{color:s==="active"?"green":"gray",variant:"subtle"},()=>s||"unknown")},enableSorting:!0},{accessorKey:"created_at",header:"Created",cell:({row:d})=>{const s=d.getValue("created_at");return s?f("span",{class:"text-xs font-mono"},new Date(s).toLocaleDateString()):"-"},enableSorting:!0},{id:"actions",header:"Actions",cell:({row:d})=>{const s=d.original,V=s.name==="superuser";return f("div",{class:"flex gap-2"},[f(Q,{variant:"ghost",size:"sm",icon:"i-heroicons-users",onClick:()=>q(s),title:"Manage Users"}),V?null:f(Q,{variant:"ghost",size:"sm",icon:"i-heroicons-pencil",onClick:()=>r(s),title:"Edit Role"}),V?null:f(Q,{variant:"ghost",size:"sm",icon:"i-heroicons-trash",color:"red",onClick:()=>N(s),title:"Delete Role"})])},enableSorting:!1}]);return(d,s)=>{const V=Q,W=Ue,w=ue,Y=be,X=xe,T=ye,Z=_e,j=fe,n=we,e=ve;return _(),h(se,null,[a("div",Oe,[a("div",Ge,[s[17]||(s[17]=a("h3",{class:"text-lg font-semibold"},"Roles",-1)),t(V,{color:"primary",size:"sm",icon:"i-heroicons-plus",onClick:s[0]||(s[0]=i=>C.value=!0)},{default:l(()=>s[16]||(s[16]=[S(" New Role ")])),_:1,__:[16]})]),p.loading?(_(),le(W,{key:0,"row-count":8,"column-count":6})):p.error?(_(),h("div",He,[t(w,{name:"i-heroicons-exclamation-triangle",class:"text-2xl mb-2"}),a("p",null,A(p.error),1)])):p.roles.length===0?(_(),h("div",Ze,[t(w,{name:"i-heroicons-user-group",class:"text-4xl mb-2"}),s[18]||(s[18]=a("p",null,"No roles found",-1))])):(_(),h("div",Je,[B.value>0?(_(),h("div",Qe,[a("div",We,[a("span",Xe,A(B.value)+" role(s) selected ",1),a("div",Ye,[t(V,{variant:"outline",size:"sm",color:"error",icon:"i-heroicons-trash"},{default:l(()=>s[19]||(s[19]=[S(" Delete Selected ")])),_:1,__:[19]}),t(V,{variant:"ghost",size:"sm",onClick:s[1]||(s[1]=i=>z.value={})},{default:l(()=>s[20]||(s[20]=[S(" Clear Selection ")])),_:1,__:[20]})])])])):J("",!0),t(Y,{"row-selection":z.value,"onUpdate:rowSelection":s[3]||(s[3]=i=>z.value=i),columns:H.value,data:p.roles,loading:p.loading,sort:{column:"created_at",direction:"desc"},class:"w-full"},{"loading-state":l(()=>[a("div",et,[t(w,{name:"i-heroicons-arrow-path",class:"animate-spin text-2xl mb-2 text-primary-500"}),s[21]||(s[21]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Loading roles...",-1))])]),"empty-state":l(()=>[a("div",tt,[t(w,{name:"i-heroicons-user-group",class:"text-4xl mb-4 text-gray-300"}),s[23]||(s[23]=a("h3",{class:"text-lg font-medium mb-2"},"No roles found",-1)),s[24]||(s[24]=a("p",{class:"text-sm text-gray-400 mb-4"},"Get started by creating your first role",-1)),t(V,{color:"primary",size:"sm",onClick:s[2]||(s[2]=i=>C.value=!0)},{default:l(()=>s[22]||(s[22]=[S(" Create Role ")])),_:1,__:[22]})])]),_:1},8,["row-selection","columns","data","loading"]),p.roles.length>0?(_(),h("div",st,[a("div",null,A(K.value.from)+" to "+A(K.value.to)+" of "+A(K.value.total),1),a("div",at,[t(X,{"default-page":R.value.pageIndex+1,page:R.value.pageIndex+1,"items-per-page":Number(R.value.pageSize),total:K.value.total,"onUpdate:page":s[4]||(s[4]=i=>{R.value.pageIndex=i-1,U("update:page",R.value)}),class:"mr-3"},null,8,["default-page","page","items-per-page","total"]),t(T,{modelValue:F.value,"onUpdate:modelValue":s[5]||(s[5]=i=>F.value=i),items:P.value,class:"w-20"},null,8,["modelValue","items"])])])):J("",!0)]))]),t(e,{open:C.value,"onUpdate:open":s[10]||(s[10]=i=>C.value=i),title:"Create New Role"},{body:l(()=>[a("div",lt,[t(j,{label:"Role Name",required:""},{default:l(()=>[t(Z,{modelValue:b.value.name,"onUpdate:modelValue":s[6]||(s[6]=i=>b.value.name=i),placeholder:"e.g. admin, editor, viewer",class:"w-full"},null,8,["modelValue"])]),_:1}),t(j,{label:"Description"},{default:l(()=>[t(n,{modelValue:b.value.description,"onUpdate:modelValue":s[7]||(s[7]=i=>b.value.description=i),placeholder:"Describe this role and its purpose",class:"w-full",rows:3},null,8,["modelValue"])]),_:1}),t(j,{label:"Status"},{default:l(()=>[t(T,{modelValue:b.value.status,"onUpdate:modelValue":s[8]||(s[8]=i=>b.value.status=i),options:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],class:"w-full"},null,8,["modelValue"])]),_:1})])]),footer:l(()=>[a("div",ot,[t(V,{variant:"ghost",onClick:s[9]||(s[9]=i=>C.value=!1)},{default:l(()=>s[25]||(s[25]=[S(" Cancel ")])),_:1,__:[25]}),t(V,{color:"primary",onClick:m},{default:l(()=>s[26]||(s[26]=[S(" Create Role ")])),_:1,__:[26]})])]),_:1},8,["open"]),t(e,{open:I.value,"onUpdate:open":s[15]||(s[15]=i=>I.value=i),title:"Edit Role"},{body:l(()=>[x.value?(_(),h("div",nt,[t(j,{label:"Role Name",required:""},{default:l(()=>[t(Z,{modelValue:x.value.name,"onUpdate:modelValue":s[11]||(s[11]=i=>x.value.name=i),placeholder:"e.g. admin, editor, viewer",class:"w-full"},null,8,["modelValue"])]),_:1}),t(j,{label:"Description"},{default:l(()=>[t(n,{modelValue:x.value.description,"onUpdate:modelValue":s[12]||(s[12]=i=>x.value.description=i),placeholder:"Describe this role and its purpose",class:"w-full",rows:3},null,8,["modelValue"])]),_:1}),t(j,{label:"Status"},{default:l(()=>[t(T,{modelValue:x.value.status,"onUpdate:modelValue":s[13]||(s[13]=i=>x.value.status=i),options:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],class:"w-full"},null,8,["modelValue"])]),_:1})])):J("",!0)]),footer:l(()=>[a("div",rt,[t(V,{variant:"ghost",onClick:s[14]||(s[14]=i=>I.value=!1)},{default:l(()=>s[27]||(s[27]=[S(" Cancel ")])),_:1,__:[27]}),t(V,{color:"primary",onClick:D},{default:l(()=>s[28]||(s[28]=[S(" Update Role ")])),_:1,__:[28]})])]),_:1},8,["open"])],64)}}}),ut={class:"p-6"},dt={class:"flex justify-between items-center mb-4"},ct={class:"mb-6 space-y-4"},pt={key:0,class:"grid grid-cols-1 md:grid-cols-4 gap-4"},mt={key:1,class:"grid grid-cols-1 md:grid-cols-4 gap-4"},gt={class:"flex gap-2"},vt={key:1,class:"py-8 text-center text-red-600 dark:text-red-400"},ft={key:2,class:"py-12 text-center text-gray-500"},_t={key:3},yt={key:0,class:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},xt={class:"flex items-center justify-between"},bt={class:"text-sm font-medium text-blue-700 dark:text-blue-300"},Ut={class:"flex gap-2"},ht={class:"py-8 text-center"},wt={class:"py-12 text-center text-gray-500"},kt={key:1,class:"mt-6 flex border-t border-gray-200 dark:border-gray-700 px-5 pt-3 justify-between items-center"},St={class:"flex"},Rt={class:"space-y-4"},Ct={class:"flex justify-end gap-2"},Vt={key:0,class:"space-y-4"},$t={class:"flex justify-end gap-2"},Pt={key:0,class:"space-y-4"},zt={class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},It={class:"space-y-2 max-h-48 overflow-y-auto"},Dt={class:"flex items-center gap-2"},At={class:"text-sm font-medium"},Ft={class:"flex justify-end gap-2"},Nt=ie({__name:"UserManagementTab",props:{users:{default:()=>[]},allRoles:{default:()=>[]},pagination:{default:()=>({current_page:1,per_page:25,total:0,last_page:1})},loading:{type:Boolean,default:!1},error:{default:null}},emits:["userCreated","refresh-data","update:page-size","update:page","on-delete"],setup(ae,{expose:M,emit:$}){const p=ae,z=g({}),R=g({search:"",status:void 0,role:void 0}),P=g({pageIndex:0,pageSize:25}),F=g(["25","50","100"]),C=g("25"),I=g(!1),b=g(!1),x=g(!1),v=g({username:"",email:"",password:"",status:"active"}),U=g(null),m=g(null),r=g([]),D=de(),N=$;function q(){N("refresh-data")}async function B(){if(!v.value.username.trim()||!v.value.email.trim()||!v.value.password.trim()){D.warn({title:"Validation Error",description:"Username, email, and password are required"});return}try{(await G.users.createUser(v.value)).success&&(D.success({title:"User Created",description:`User "${v.value.username}" created successfully.`}),I.value=!1,v.value={username:"",email:"",password:"",status:"active"},N("refresh-data"))}catch(n){const e=n;D.error({title:"Error",description:e.message||"Failed to create user"})}}function K(n){U.value={...n},b.value=!0}async function H(){if(U.value)try{(await G.users.updateUser(U.value.uuid,{username:U.value.username,email:U.value.email,status:U.value.status})).success&&(D.success({title:"User Updated",description:`User "${U.value.username}" updated successfully.`}),b.value=!1,U.value=null,N("refresh-data"))}catch(n){const e=n;D.error({title:"Error",description:e.message||"Failed to update user"})}}async function d(n){try{(await G.users.deleteUser(n.uuid)).success&&(D.success({title:"User Deleted",description:`User "${n.username}" deleted successfully.`}),N("refresh-data"))}catch(e){const i=e;D.error({title:"Error",description:i.message||"Failed to delete user"})}}function s(n){var e;m.value=n,r.value=((e=n.roles)==null?void 0:e.map(i=>i.uuid))||[],x.value=!0}async function V(){if(m.value)try{(await G.users.updateUser(m.value.uuid,{roles:r.value})).success&&(D.success({title:"Roles Updated",description:`Roles updated for user "${m.value.username}".`}),x.value=!1,m.value=null,r.value=[],N("refresh-data"))}catch(n){const e=n;D.error({title:"Error",description:e.message||"Failed to update user roles"})}}function W(){R.value={search:"",status:void 0,role:void 0},N("refresh-data")}let w=null;function Y(){w&&clearTimeout(w),w=setTimeout(()=>{N("refresh-data")},500)}oe(()=>p.pagination,n=>{n&&(P.value.pageIndex=n.current_page-1,P.value.pageSize=n.per_page,C.value=String(n.per_page))},{immediate:!0}),oe(()=>C.value,n=>{P.value.pageSize=Number(n),P.value.pageIndex=0,N("update:page-size",n)});const X=O(()=>Object.keys(z.value).length),T=O(()=>{var L,E,o,y,c;const n=((L=p.pagination)==null?void 0:L.total)||0,e=((((E=p.pagination)==null?void 0:E.current_page)||1)-1)*(((o=p.pagination)==null?void 0:o.per_page)||25)+1,i=Math.min((((y=p.pagination)==null?void 0:y.current_page)||1)*(((c=p.pagination)==null?void 0:c.per_page)||25),n);return{from:e,to:i,total:n}}),Z=O(()=>{var n;return!!((n=R.value.search)!=null&&n.trim()||R.value.status||R.value.role)});M({refresh:()=>N("refresh-data")});const j=O(()=>[{id:"select",header:({table:n})=>f(re,{modelValue:n.getIsAllPageRowsSelected(),"onUpdate:modelValue":e=>n.toggleAllPageRowsSelected(!!e),indeterminate:n.getIsSomePageRowsSelected()}),cell:({row:n})=>f(re,{modelValue:n.getIsSelected(),"onUpdate:modelValue":e=>n.toggleSelected(!!e)}),enableSorting:!1,enableHiding:!1},{accessorKey:"username",header:"Username",cell:({getValue:n})=>{const e=n();return f("div",{class:"font-semibold text-sm text-gray-900 dark:text-gray-100"},e)},enableSorting:!0},{accessorKey:"email",header:"Email",cell:({getValue:n})=>{const e=n();return f("div",{class:"text-sm text-gray-600 dark:text-gray-400"},e)},enableSorting:!0},{accessorKey:"status",header:"Status",cell:({getValue:n})=>{const e=n();return f(te,{color:e==="active"?"green":e==="inactive"?"yellow":"red",variant:"subtle",size:"sm"},()=>(e==null?void 0:e.charAt(0).toUpperCase())+(e==null?void 0:e.slice(1))||"Unknown")},enableSorting:!0},{accessorKey:"roles",header:"Roles",cell:({getValue:n})=>{const e=n()||[];if(e.length===0)return f("span",{class:"text-sm text-gray-400 italic"},"No roles assigned");const i=e.slice(0,2),L=e.length-2,E=i.map(o=>f(te,{key:o.uuid,variant:"subtle",color:o.name==="superuser"?"red":"blue",size:"sm",class:"mr-1 mb-1"},()=>o.name));return L>0&&E.push(f(te,{key:"more",variant:"outline",color:"gray",size:"sm",class:"mr-1 mb-1"},()=>`+${L}`)),f("div",{class:"flex flex-wrap gap-1"},E)},enableSorting:!1},{accessorKey:"last_login_date",header:"Last Login",cell:({getValue:n})=>{const e=n();if(!e)return f("span",{class:"text-xs text-gray-400 italic"},"Never");const i=new Date(e),L=Date.now()-i.getTime()<7*24*60*60*1e3;return f("span",{class:`text-xs font-mono ${L?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"}`,title:i.toLocaleString()},i.toLocaleDateString())},enableSorting:!0},{accessorKey:"created_at",header:"Created",cell:({getValue:n})=>{const e=n();if(!e)return f("span",{class:"text-xs text-gray-400"},"-");const i=new Date(e);return f("span",{class:"text-xs font-mono text-gray-600 dark:text-gray-400",title:i.toLocaleString()},i.toLocaleDateString())},enableSorting:!0},{id:"actions",header:"Actions",cell:({row:n})=>{const e=n.original;return f(De,{items:[[{label:"Assign Roles",icon:"i-heroicons-user-group",onSelect:()=>s(e)},{label:"Edit User",icon:"i-heroicons-pencil",onSelect:()=>K(e)}],[{label:"Delete User",icon:"i-heroicons-trash",onSelect:()=>d(e),color:"error"}]]},()=>f(Q,{variant:"ghost",size:"sm",icon:"i-heroicons-ellipsis-horizontal","aria-label":"User actions"}))},enableSorting:!1}]);return(n,e)=>{const i=Q,L=Ie,E=_e,o=fe,y=ye,c=Ue,k=ue,ce=be,ne=xe,ee=ve,pe=re,me=te;return _(),h(se,null,[a("div",ut,[a("div",dt,[e[24]||(e[24]=a("h3",{class:"text-lg font-semibold"},"User Management",-1)),t(i,{color:"primary",size:"sm",icon:"i-heroicons-plus",onClick:e[0]||(e[0]=u=>I.value=!0)},{default:l(()=>e[23]||(e[23]=[S(" New User ")])),_:1,__:[23]})]),a("div",ct,[p.loading&&p.users.length===0?(_(),h("div",pt,[(_(),h(se,null,ge(4,u=>a("div",{key:`filter-skeleton-${u}`,class:"space-y-2"},[t(L,{class:"h-4 w-24"}),t(L,{class:"h-10 w-full",ui:{rounded:"rounded-md"}})])),64))])):(_(),h("div",mt,[t(o,{label:"Search users"},{default:l(()=>[t(E,{modelValue:R.value.search,"onUpdate:modelValue":e[1]||(e[1]=u=>R.value.search=u),placeholder:"Search by username or email...",icon:"i-heroicons-magnifying-glass",onInput:Y},null,8,["modelValue"])]),_:1}),t(o,{label:"Filter by status"},{default:l(()=>[t(y,{modelValue:R.value.status,"onUpdate:modelValue":[e[2]||(e[2]=u=>R.value.status=u),q],items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],placeholder:"Filter by status...","value-key":"value",clearable:""},null,8,["modelValue"])]),_:1}),t(o,{label:"Filter by role"},{default:l(()=>[t(y,{modelValue:R.value.role,"onUpdate:modelValue":[e[3]||(e[3]=u=>R.value.role=u),q],items:p.allRoles.map(u=>({label:u.name,value:u.uuid})),placeholder:"Filter by role...","value-key":"value",clearable:"",searchable:""},null,8,["modelValue","items"])]),_:1}),t(o,{label:"Actions"},{default:l(()=>[a("div",gt,[Z.value?(_(),le(i,{key:0,variant:"outline",icon:"i-heroicons-x-mark",onClick:W,size:"sm"},{default:l(()=>e[25]||(e[25]=[S(" Clear Filters ")])),_:1,__:[25]})):J("",!0),t(i,{variant:"outline",icon:"i-heroicons-arrow-path",onClick:e[4]||(e[4]=u=>q()),size:"sm",loading:p.loading},{default:l(()=>e[26]||(e[26]=[S(" Refresh ")])),_:1,__:[26]},8,["loading"])])]),_:1})]))]),p.loading&&p.users.length===0?(_(),le(c,{key:0,"row-count":10,"column-count":8})):p.error?(_(),h("div",vt,[t(k,{name:"i-heroicons-exclamation-triangle",class:"text-2xl mb-2"}),a("p",null,A(p.error),1)])):p.users.length===0?(_(),h("div",ft,[t(k,{name:"i-heroicons-users",class:"text-4xl mb-2"}),e[27]||(e[27]=a("p",null,"No users found",-1))])):(_(),h("div",_t,[X.value>0?(_(),h("div",yt,[a("div",xt,[a("span",bt,A(X.value)+" user(s) selected ",1),a("div",Ut,[t(i,{variant:"outline",size:"sm",color:"error",icon:"i-heroicons-trash"},{default:l(()=>e[28]||(e[28]=[S(" Delete Selected ")])),_:1,__:[28]}),t(i,{variant:"ghost",size:"sm",onClick:e[5]||(e[5]=u=>z.value={})},{default:l(()=>e[29]||(e[29]=[S(" Clear Selection ")])),_:1,__:[29]})])])])):J("",!0),t(ce,{"row-selection":z.value,"onUpdate:rowSelection":e[7]||(e[7]=u=>z.value=u),columns:j.value,data:p.users,loading:p.loading,sort:{column:"created_at",direction:"desc"},class:"w-full"},{"loading-state":l(()=>[a("div",ht,[t(k,{name:"i-heroicons-arrow-path",class:"animate-spin text-2xl mb-2 text-primary-500"}),e[30]||(e[30]=a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Loading users...",-1))])]),"empty-state":l(()=>[a("div",wt,[t(k,{name:"i-heroicons-users",class:"text-4xl mb-4 text-gray-300"}),e[32]||(e[32]=a("h3",{class:"text-lg font-medium mb-2"},"No users found",-1)),e[33]||(e[33]=a("p",{class:"text-sm text-gray-400 mb-4"},"Get started by creating your first user",-1)),t(i,{color:"primary",size:"sm",onClick:e[6]||(e[6]=u=>I.value=!0)},{default:l(()=>e[31]||(e[31]=[S(" Create User ")])),_:1,__:[31]})])]),_:1},8,["row-selection","columns","data","loading"]),p.users.length>0?(_(),h("div",kt,[a("div",null,A(T.value.from)+" to "+A(T.value.to)+" of "+A(T.value.total),1),a("div",St,[t(ne,{"default-page":P.value.pageIndex+1,page:P.value.pageIndex+1,"items-per-page":Number(P.value.pageSize),total:T.value.total,"onUpdate:page":e[8]||(e[8]=u=>{P.value.pageIndex=u-1,N("update:page",P.value)}),class:"mr-3"},null,8,["default-page","page","items-per-page","total"]),t(y,{modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=u=>C.value=u),items:F.value,class:"w-20"},null,8,["modelValue","items"])])])):J("",!0)]))]),t(ee,{open:I.value,"onUpdate:open":e[15]||(e[15]=u=>I.value=u),title:"Create New User"},{body:l(()=>[a("div",Rt,[t(o,{label:"Username",required:""},{default:l(()=>[t(E,{modelValue:v.value.username,"onUpdate:modelValue":e[10]||(e[10]=u=>v.value.username=u),placeholder:"e.g. john_doe",class:"w-full"},null,8,["modelValue"])]),_:1}),t(o,{label:"Email",required:""},{default:l(()=>[t(E,{modelValue:v.value.email,"onUpdate:modelValue":e[11]||(e[11]=u=>v.value.email=u),type:"email",placeholder:"e.g. john@example.com",class:"w-full"},null,8,["modelValue"])]),_:1}),t(o,{label:"Password",required:""},{default:l(()=>[t(E,{modelValue:v.value.password,"onUpdate:modelValue":e[12]||(e[12]=u=>v.value.password=u),type:"password",placeholder:"Enter password",class:"w-full"},null,8,["modelValue"])]),_:1}),t(o,{label:"Status"},{default:l(()=>[t(y,{modelValue:v.value.status,"onUpdate:modelValue":e[13]||(e[13]=u=>v.value.status=u),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],placeholder:"Select status...","value-key":"value",class:"w-full"},null,8,["modelValue"])]),_:1})])]),footer:l(()=>[a("div",Ct,[t(i,{variant:"ghost",onClick:e[14]||(e[14]=u=>I.value=!1)},{default:l(()=>e[34]||(e[34]=[S(" Cancel ")])),_:1,__:[34]}),t(i,{color:"primary",onClick:B},{default:l(()=>e[35]||(e[35]=[S(" Create User ")])),_:1,__:[35]})])]),_:1},8,["open"]),t(ee,{open:b.value,"onUpdate:open":e[20]||(e[20]=u=>b.value=u),title:"Edit User"},{body:l(()=>[U.value?(_(),h("div",Vt,[t(o,{label:"Username",required:""},{default:l(()=>[t(E,{modelValue:U.value.username,"onUpdate:modelValue":e[16]||(e[16]=u=>U.value.username=u),placeholder:"e.g. john_doe",class:"w-full"},null,8,["modelValue"])]),_:1}),t(o,{label:"Email",required:""},{default:l(()=>[t(E,{modelValue:U.value.email,"onUpdate:modelValue":e[17]||(e[17]=u=>U.value.email=u),type:"email",placeholder:"e.g. john@example.com",class:"w-full"},null,8,["modelValue"])]),_:1}),t(o,{label:"Status"},{default:l(()=>[t(y,{modelValue:U.value.status,"onUpdate:modelValue":e[18]||(e[18]=u=>U.value.status=u),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}],placeholder:"Select status...","value-key":"value",class:"w-full"},null,8,["modelValue"])]),_:1})])):J("",!0)]),footer:l(()=>[a("div",$t,[t(i,{variant:"ghost",onClick:e[19]||(e[19]=u=>b.value=!1)},{default:l(()=>e[36]||(e[36]=[S(" Cancel ")])),_:1,__:[36]}),t(i,{color:"primary",onClick:H},{default:l(()=>e[37]||(e[37]=[S(" Update User ")])),_:1,__:[37]})])]),_:1},8,["open"]),t(ee,{open:x.value,"onUpdate:open":e[22]||(e[22]=u=>x.value=u),title:"Assign Roles"},{body:l(()=>[m.value?(_(),h("div",Pt,[a("div",null,[a("p",zt,[e[38]||(e[38]=S(" Assign roles to: ")),a("strong",null,A(m.value.username),1)])]),t(o,{label:"Select Roles"},{default:l(()=>[a("div",It,[(_(!0),h(se,null,ge(p.allRoles,u=>(_(),h("div",{key:u.uuid,class:"flex items-center space-x-3"},[t(pe,{"model-value":r.value.includes(u.uuid),"onUpdate:modelValue":ke=>{ke===!0?r.value.push(u.uuid):r.value=r.value.filter(Se=>Se!==u.uuid)}},null,8,["model-value","onUpdate:modelValue"]),a("div",Dt,[a("span",At,A(u.name),1),u.name==="superuser"?(_(),le(me,{key:0,color:"error",variant:"subtle"},{default:l(()=>e[39]||(e[39]=[S(" Admin ")])),_:1,__:[39]})):J("",!0)])]))),128))])]),_:1})])):J("",!0)]),footer:l(()=>[a("div",Ft,[t(i,{variant:"ghost",onClick:e[21]||(e[21]=u=>x.value=!1)},{default:l(()=>e[40]||(e[40]=[S(" Cancel ")])),_:1,__:[40]}),t(i,{color:"primary",onClick:V},{default:l(()=>e[41]||(e[41]=[S(" Update Roles ")])),_:1,__:[41]})])]),_:1},8,["open"])],64)}}}),Tt={class:"space-y-6"},jt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Et={class:"flex items-center justify-between"},Mt={class:"text-2xl font-bold text-shark-900 dark:text-shark-100"},qt={class:"flex items-center justify-between"},Bt={class:"text-2xl font-bold text-green-600 dark:text-green-400"},Kt={class:"flex items-center justify-between"},Lt={class:"text-2xl font-bold text-purple-600 dark:text-purple-400"},Ot=ie({__name:"permissions",setup(ae){const M=g(!1),$=g(null),p=g(),z=g(),R=g(),P=g([]),F=g([]),C=g([]),I=g({current_page:1,per_page:25,total:0,last_page:1}),b=g({current_page:1,per_page:25,total:0,last_page:1}),x=g({current_page:1,per_page:25,total:0,last_page:1}),v=de(),U=O(()=>C.value.length),m=O(()=>P.value.filter(o=>o.status==="active").length),r=O(()=>F.value.length);function D(){Z()}function N(){j()}function q(){n()}const B=async()=>{await T()},K=async o=>{await n({page:1,per_page:parseInt(o),include_deleted:!1})},H=async o=>{await n({page:o.pageIndex+1,per_page:o.pageSize,include_deleted:!1})},d=async o=>{await Z({page:1,per_page:parseInt(o)})},s=async o=>{await Z({page:o.pageIndex+1,per_page:o.pageSize})},V=async()=>{await n({page:I.value.current_page,per_page:I.value.per_page,include_deleted:!1})},W=async()=>{await Z({page:b.value.current_page,per_page:b.value.per_page})},w=async o=>{await j({page:1,per_page:parseInt(o),include_deleted:!0})},Y=async o=>{await j({page:o.pageIndex+1,per_page:o.pageSize,include_deleted:!0})},X=async()=>{await j({page:x.value.current_page,per_page:x.value.per_page,include_deleted:!0})};async function T(){M.value=!0,$.value=null;try{const[o,y,c]=await Promise.allSettled([Z(),j(),n()]),k=[];o.status==="rejected"&&(k.push("permissions"),console.error("Failed to fetch permissions:",o.reason)),y.status==="rejected"&&(k.push("roles"),console.error("Failed to fetch roles:",y.reason)),c.status==="rejected"&&(k.push("users"),console.error("Failed to fetch users:",c.reason)),k.length>0&&v.error({title:"Partial Data Load",description:`Failed to load: ${k.join(", ")}. Please try refreshing.`})}catch(o){const y=o;$.value=y.message||"Failed to fetch data",v.error({title:"Error",description:$.value})}finally{M.value=!1}}async function Z(o){const y={page:(o==null?void 0:o.page)||1,per_page:(o==null?void 0:o.per_page)||25},c=await G.permissions.getAllPermissions(y);if(c.success&&c.data){let k=[];Array.isArray(c.data)?k=c.data:c.data.data?(k=c.data.data,b.value={current_page:c.data.current_page||1,per_page:c.data.per_page||25,total:c.data.total||0,last_page:c.data.last_page||1}):k=c.data,C.value=k}}async function j(o){const y={page:(o==null?void 0:o.page)||1,per_page:(o==null?void 0:o.per_page)||25,include_deleted:(o==null?void 0:o.include_deleted)||!0},c=await G.roles.getAllRoles(y);if(c.success&&c.data){let k=[];Array.isArray(c.data)?k=c.data:c.data.data?(k=c.data.data,x.value={current_page:c.data.current_page||y.page,per_page:c.data.per_page||y.per_page,total:c.data.total||0,last_page:c.data.last_page||1}):k=c.data,P.value=k}else P.value=[]}async function n(o){var k;const y={page:(o==null?void 0:o.page)||1,per_page:(o==null?void 0:o.per_page)||25,include_deleted:(o==null?void 0:o.include_deleted)||!1},c=await G.users.getAllUsers(y);c.success&&(Array.isArray(c.data)?F.value=c.data:(k=c.data)!=null&&k.data?(F.value=c.data.data,I.value={current_page:c.data.current_page||y.page,per_page:c.data.per_page||y.per_page,total:c.data.total||0,last_page:c.data.last_page||1}):F.value=[])}function e(){v.info({title:"Feature Coming Soon",description:"Permission editing will be available in a future update."})}function i(){v.info({title:"Feature Coming Soon",description:"Permission deletion will be available in a future update."})}function L(){v.info({title:"Feature Coming Soon",description:"User-role management will be available in a future update."})}async function E(){await T(),v.success({title:"Refreshed",description:"Permission data updated."})}return $e(()=>{T()}),(o,y)=>{const c=Q,k=ze,ce=Pe,ne=ue,ee=Ve,pe=Ce,me=Re;return _(),le(me,{id:"permissions"},{header:l(()=>[t(k,{title:"Permissions & Roles"},{right:l(()=>[t(c,{variant:"ghost",icon:"i-heroicons-arrow-path",loading:M.value,onClick:E,size:"sm"},null,8,["loading"])]),_:1})]),body:l(()=>[a("div",Tt,[a("div",jt,[M.value?(_(),h(se,{key:0},ge(3,u=>t(ce,{key:`card-skeleton-${u}`,"show-header":!1,"show-image":!1,"line-count":0,"show-title":!1})),64)):(_(),h(se,{key:1},[t(ee,null,{default:l(()=>[a("div",Et,[a("div",null,[y[0]||(y[0]=a("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"}," Permission Entries ",-1)),a("p",Mt,A(U.value),1)]),t(ne,{name:"i-heroicons-key",class:"h-8 w-8 text-blue-500"})])]),_:1}),t(ee,null,{default:l(()=>[a("div",qt,[a("div",null,[y[1]||(y[1]=a("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Active Roles",-1)),a("p",Bt,A(m.value),1)]),t(ne,{name:"i-heroicons-user-group",class:"h-8 w-8 text-green-500"})])]),_:1}),t(ee,null,{default:l(()=>[a("div",Kt,[a("div",null,[y[2]||(y[2]=a("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Total Users",-1)),a("p",Lt,A(r.value),1)]),t(ne,{name:"i-heroicons-users",class:"h-8 w-8 text-purple-500"})])]),_:1})],64))]),t(pe,{items:[{label:"Permissions",icon:"i-heroicons-key",slot:"permissions"},{label:"Roles",icon:"i-heroicons-user-group",slot:"roles"},{label:"User Management",icon:"i-heroicons-users",slot:"users"}],class:"w-full",variant:"link"},{permissions:l(()=>[t(Le,{ref_key:"permissionsTabRef",ref:p,permissions:C.value,pagination:b.value,loading:M.value,error:$.value,onEditPermission:e,onDeletePermission:i,onPermissionCreated:D,onRefreshData:B,"onUpdate:pageSize":d,"onUpdate:page":s,onOnDelete:W},null,8,["permissions","pagination","loading","error"])]),roles:l(()=>[t(it,{ref_key:"rolesTabRef",ref:z,roles:P.value,pagination:x.value,loading:M.value,error:$.value,onManageRoleUsers:L,onRoleCreated:N,onRefreshData:B,"onUpdate:pageSize":w,"onUpdate:page":Y,onOnDelete:X},null,8,["roles","pagination","loading","error"])]),users:l(()=>[t(Nt,{ref_key:"userManagementTabRef",ref:R,users:F.value,"all-roles":P.value,pagination:I.value,loading:M.value,error:$.value,onUserCreated:q,onRefreshData:B,"onUpdate:pageSize":K,"onUpdate:page":H,onOnDelete:V},null,8,["users","all-roles","pagination","loading","error"])]),_:1})])]),_:1})}}});typeof he=="function"&&he(Ot);export{Ot as default};
