import{_ as J,b as B}from"./route-block-C8UpW1tJ.js";import{_ as D}from"./Badge-UswX4ZtY.js";import{_ as Q}from"./Table-DfRn1MFI.js";import{_ as W}from"./TableDataSkeleton.vue_vue_type_script_setup_true_lang-C_75FIk9.js";import{_ as X}from"./Card-3ffy2SwE.js";import{d as ee,r as u,f as S,av as h,A as te,i as M,o as i,j as a,Z as t,k as s,z as F,B as m,F as P,ai as z,O as d,am as oe,N as y,ah as se,at as V}from"./index-CvplhhIg.js";import{_ as ae}from"./CardSkeleton.vue_vue_type_script_setup_true_lang-bZ34LqmC.js";import{_ as ne}from"./DashboardNavbar.vue_vue_type_script_setup_true_lang-DXiLQDGX.js";import{_ as I}from"./Checkbox-DpWF0v5s.js";import{u as le}from"./useToastNotification-D4GVV2D1.js";import"./DashboardResizeHandle.vue_vue_type_script_setup_true_lang-Bj9eNWfO.js";import"./DashboardSidebarToggle.vue_vue_type_script_setup_true_lang-yvinZowi.js";import"./index-88opOQSr.js";import"./Skeleton-BW74k3wi.js";import"./useDirection-L6XtVArv.js";import"./isValueEqualOrExist-Fpwey4SD.js";import"./useFormControl-DwrQSjJN.js";import"./RovingFocusItem-D4fW7EEy.js";import"./RovingFocusGroup-BxD9bDZV.js";import"./VisuallyHiddenInput-C__kJX8b.js";import"./Label-CHQ0EKZ9.js";const ie={key:0,class:"flex items-center gap-2"},re={class:"text-sm text-boulder-600 dark:text-boulder-400"},de={class:"space-y-6"},ce={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ue={class:"flex items-center justify-between"},me={class:"text-2xl font-bold text-shark-900 dark:text-shark-100"},pe={class:"flex items-center justify-between"},ge={class:"text-2xl font-bold text-green-600 dark:text-green-400"},fe={class:"flex items-center justify-between"},xe={class:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"},_e={class:"flex items-center justify-between"},ve={class:"text-sm text-boulder-500 dark:text-boulder-400"},be={key:1,class:"py-8 text-center text-red-600 dark:text-red-400"},he={key:2,class:"py-12 text-center text-boulder-500 dark:text-boulder-400"},ye={key:3},ke={class:"py-12 text-center text-boulder-500 dark:text-boulder-400"},we={class:"flex items-center justify-between"},Se={class:"space-y-2"},Me={class:"flex items-center gap-3"},Ae={class:"font-mono text-sm font-medium"},Ce={class:"text-xs text-boulder-600 dark:text-boulder-400 font-mono"},Pe={class:"flex items-center justify-between"},Ve={class:"text-center py-8"},Re={class:"text-boulder-600 dark:text-boulder-400"},Ne=ee({__name:"migrations",setup($e){const p=u(!1),k=u(!1),w=u(null),g=u([]),A=u([]),f=le(),x=u({}),R=u([]),N=u({}),K=S(()=>g.value.filter(o=>o.applied)),_=S(()=>A.value.length),$=S(()=>K.value.length),O=S(()=>[{id:"select",header:({table:o})=>h(I,{modelValue:o.getIsAllPageRowsSelected(),"onUpdate:modelValue":e=>o.toggleAllPageRowsSelected(!!e),indeterminate:o.getIsSomePageRowsSelected()}),cell:({row:o})=>h(I,{modelValue:o.getIsSelected(),"onUpdate:modelValue":e=>o.toggleSelected(!!e),disabled:o.original.applied}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:"Migration Name",cell:({row:o})=>{const e=o.getValue("name");return h("div",{class:"font-mono text-sm",title:e},e)},enableSorting:!0},{accessorKey:"applied",header:"Status",cell:({row:o})=>{const e=o.getValue("applied");return h(D,{color:e?"green":"yellow",variant:"subtle"},()=>e?"Applied":"Pending")},enableSorting:!0},{accessorKey:"batch",header:"Batch",cell:({row:o})=>o.getValue("batch")||"—",enableSorting:!0},{accessorKey:"applied_at",header:"Applied At",cell:({row:o})=>{const e=o.getValue("applied_at");return e?h("span",{class:"text-xs font-mono"},E(e)):"—"},enableSorting:!0},{accessorKey:"path",header:"File Path",cell:({row:o})=>{const e=o.getValue("path");return h("div",{class:"max-w-xs truncate text-xs text-boulder-600 dark:text-boulder-400 font-mono",title:e},e)},enableSorting:!1}]),E=o=>new Date(o).toLocaleString();async function C(){var o,e;p.value=!0,w.value=null;try{const[l,v]=await Promise.all([V.migrations.getAllMigrations(),V.migrations.getPendingMigrations()]);if(l.success){const c=Array.isArray(l.data)?l.data:((o=l.data)==null?void 0:o.migrations)||[];g.value=c.map(n=>({name:n.migration||n.name,path:n.migration||n.path||n.name,batch:n.batch,applied:!0,applied_at:n.applied_at,description:n.description}))}v.success&&(A.value=(((e=v.data)==null?void 0:e.migrations)||[]).map(c=>({name:c.name||c.migration,path:c.path||c.migration,applied:!1})))}catch(l){const v=l;w.value=v.message||"Failed to fetch migrations",f.error({title:"Error",description:w.value})}finally{p.value=!1}}async function j(){var o;if(_.value===0){f.warn({title:"No Pending Migrations",description:"There are no pending migrations to run."});return}k.value=!0;try{const e=await V.migrations.runPendingMigrations();if(e.success){const l=((o=e.data.applied)==null?void 0:o.length)||0;f.success({title:"Migrations Applied",description:`Successfully applied ${l} migration(s).`}),await C()}}catch(e){const l=e;f.error({title:"Migration Failed",description:l.message||"Failed to run migrations"})}finally{k.value=!1}}async function L(){if(Object.keys(x.value).filter(e=>x.value[e]).length===0){f.warn({title:"No Migrations Selected",description:"Please select migrations to run."});return}f.info({title:"Feature Coming Soon",description:"Individual migration selection will be available in a future update."})}async function H(){await C(),f.success({title:"Refreshed",description:"Migration status updated."})}function Y(){x.value={}}const U=S(()=>Object.keys(x.value).length);return te(()=>{C()}),(o,e)=>{const l=se,v=ne,c=ae,n=oe,b=X,Z=W,q=Q,T=D,G=J;return i(),M(G,{id:"migrations"},{header:a(()=>[s(v,{title:"Database Migrations"},{right:a(()=>[U.value>0?(i(),m("div",ie,[t("span",re,d(U.value)+" selected",1),s(l,{variant:"outline",size:"sm",icon:"i-heroicons-play",onClick:L},{default:a(()=>e[3]||(e[3]=[y(" Run Selected ")])),_:1,__:[3]}),s(l,{variant:"ghost",size:"sm",icon:"i-heroicons-x-mark",onClick:Y},{default:a(()=>e[4]||(e[4]=[y(" Clear ")])),_:1,__:[4]})])):F("",!0),s(l,{color:"primary",size:"sm",icon:"i-heroicons-play",loading:k.value,disabled:_.value===0||k.value,onClick:j},{default:a(()=>[y(" Run All Pending ("+d(_.value)+") ",1)]),_:1},8,["loading","disabled"]),s(l,{variant:"ghost",icon:"i-heroicons-arrow-path",loading:p.value,onClick:H,size:"sm"},null,8,["loading"])]),_:1})]),body:a(()=>[t("div",de,[t("div",ce,[p.value?(i(),m(P,{key:0},z(3,r=>s(c,{key:`card-skeleton-${r}`,"show-header":!1,"show-image":!1,"line-count":0,"show-title":!1})),64)):(i(),m(P,{key:1},[s(b,null,{default:a(()=>[t("div",ue,[t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Total Migrations",-1)),t("p",me,d(g.value.length),1)]),s(n,{name:"i-heroicons-document-text",class:"h-8 w-8 text-blue-500"})])]),_:1}),s(b,null,{default:a(()=>[t("div",pe,[t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Applied",-1)),t("p",ge,d($.value),1)]),s(n,{name:"i-heroicons-check-circle",class:"h-8 w-8 text-green-500"})])]),_:1}),s(b,null,{default:a(()=>[t("div",fe,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-boulder-600 dark:text-boulder-400"},"Pending",-1)),t("p",xe,d(_.value),1)]),s(n,{name:"i-heroicons-clock",class:"h-8 w-8 text-yellow-500"})])]),_:1})],64))]),s(b,null,{header:a(()=>[t("div",_e,[e[8]||(e[8]=t("h3",{class:"text-lg font-medium"},"All Migrations",-1)),t("div",ve,d(g.value.length)+" total migrations",1)])]),default:a(()=>[p.value?(i(),M(Z,{key:0,"row-count":8,"column-count":6})):w.value?(i(),m("div",be,[s(n,{name:"i-heroicons-exclamation-triangle",class:"text-2xl mb-2"}),t("p",null,d(w.value),1)])):g.value.length===0?(i(),m("div",he,[s(n,{name:"i-heroicons-document-text",class:"text-4xl mb-2"}),e[9]||(e[9]=t("p",null,"No migrations found",-1))])):(i(),m("div",ye,[s(q,{"row-selection":x.value,"onUpdate:rowSelection":e[0]||(e[0]=r=>x.value=r),sorting:R.value,"onUpdate:sorting":e[1]||(e[1]=r=>R.value=r),"column-visibility":N.value,"onUpdate:columnVisibility":e[2]||(e[2]=r=>N.value=r),columns:O.value,data:g.value,loading:p.value,sticky:"",class:"w-full",ui:{th:"px-4 py-3.5 text-sm text-highlighted text-left rtl:text-right font-semibold whitespace-nowrap"}},{empty:a(()=>[t("div",ke,[s(n,{name:"i-heroicons-document-text",class:"text-4xl mb-2"}),e[10]||(e[10]=t("p",null,"No migrations found",-1))])]),_:1},8,["row-selection","sorting","column-visibility","columns","data","loading"])]))]),_:1}),_.value>0?(i(),M(b,{key:0},{header:a(()=>[t("div",we,[e[11]||(e[11]=t("h3",{class:"text-lg font-medium text-yellow-600 dark:text-yellow-400"}," Pending Migrations ",-1)),s(T,{color:"warning",variant:"subtle"},{default:a(()=>[y(d(_.value)+" pending",1)]),_:1})])]),footer:a(()=>[t("div",Pe,[e[14]||(e[14]=t("p",{class:"text-sm text-boulder-600 dark:text-boulder-400"}," These migrations are ready to be applied to your database. ",-1)),s(l,{color:"warning",variant:"outline",size:"sm",icon:"i-heroicons-play",loading:k.value,onClick:j},{default:a(()=>e[13]||(e[13]=[y(" Run All Pending ")])),_:1,__:[13]},8,["loading"])])]),default:a(()=>[t("div",Se,[(i(!0),m(P,null,z(A.value,r=>(i(),m("div",{key:r.name,class:"flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800"},[t("div",Me,[s(n,{name:"i-heroicons-clock",class:"text-yellow-500"}),t("div",null,[t("p",Ae,d(r.name),1),t("p",Ce,d(r.path),1)])]),s(T,{color:"warning",variant:"subtle"},{default:a(()=>e[12]||(e[12]=[y("Pending")])),_:1,__:[12]})]))),128))])]),_:1})):g.value.length>0&&!p.value?(i(),M(b,{key:1},{default:a(()=>[t("div",Ve,[s(n,{name:"i-heroicons-check-circle",class:"text-6xl text-green-500 mb-4"}),e[15]||(e[15]=t("h3",{class:"text-lg font-medium text-green-600 dark:text-green-400 mb-2"}," All Migrations Applied ",-1)),t("p",Re," Your database is up to date. All "+d($.value)+" migrations have been applied. ",1)])]),_:1})):F("",!0)])]),_:1})}}});typeof B=="function"&&B(Ne);export{Ne as default};
